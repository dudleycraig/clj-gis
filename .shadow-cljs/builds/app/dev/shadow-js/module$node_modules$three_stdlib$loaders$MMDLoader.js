["^ ","~:resource-id",["~:shadow.build.npm/resource","node_modules/three-stdlib/loaders/MMDLoader.js"],"~:js","shadow$provide.module$node_modules$three_stdlib$loaders$MMDLoader=function(global,require,module,exports){function _typeof(obj$jscomp$0){_typeof=\"function\"===typeof Symbol&&\"symbol\"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&\"function\"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?\"symbol\":typeof obj};return _typeof(obj$jscomp$0)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError(\"Cannot call a class as a function\");\n}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;\"value\"in descriptor&&(descriptor.writable=!0);Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps);staticProps&&_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,\ncall){if(call&&(\"object\"===_typeof(call)||\"function\"===typeof call))return call;if(void 0===self)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return self}function _getPrototypeOf(o$jscomp$0){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o$jscomp$0)}function _inherits(subClass,superClass){if(\"function\"!==typeof superClass&&null!==superClass)throw new TypeError(\"Super expression must either be null or a function\");\nsubClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}});superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o$jscomp$0,p$jscomp$0){_setPrototypeOf=Object.setPrototypeOf||function(o,p){o.__proto__=p;return o};return _setPrototypeOf(o$jscomp$0,p$jscomp$0)}Object.defineProperty(exports,\"__esModule\",{value:!0});exports.MMDLoader=void 0;var _three=require(\"module$node_modules$three$build$three_module\"),_TGALoader=\nrequire(\"module$node_modules$three_stdlib$loaders$TGALoader\"),_mmdParser=require(\"module$node_modules$mmd_parser$build$mmdparser\");global=function(_Loader){function MMDLoader(manager){_classCallCheck(this,MMDLoader);manager=_possibleConstructorReturn(this,_getPrototypeOf(MMDLoader).call(this,manager));manager.loader=new _three.FileLoader(manager.manager);manager.parser=null;manager.meshBuilder=new MeshBuilder(manager.manager);manager.animationBuilder=new AnimationBuilder;return manager}_inherits(MMDLoader,\n_Loader);_createClass(MMDLoader,[{key:\"setAnimationPath\",value:function(animationPath){this.animationPath=animationPath;return this}},{key:\"load\",value:function(url,onLoad,onProgress,onError){var builder=this.meshBuilder.setCrossOrigin(this.crossOrigin);var resourcePath=\"\"!==this.resourcePath?this.resourcePath:\"\"!==this.path?this.path:_three.LoaderUtils.extractUrlBase(url);var modelExtension=this._extractExtension(url).toLowerCase();if(\"pmd\"!==modelExtension&&\"pmx\"!==modelExtension)onError&&onError(Error(\"THREE.MMDLoader: Unknown model file extension .\"+\nmodelExtension+\".\"));else this[\"pmd\"===modelExtension?\"loadPMD\":\"loadPMX\"](url,function(data){onLoad(builder.build(data,resourcePath,onProgress,onError))},onProgress,onError)}},{key:\"loadAnimation\",value:function(url,object,onLoad,onProgress,onError){var builder=this.animationBuilder;this.loadVMD(url,function(vmd){onLoad(object.isCamera?builder.buildCameraAnimation(vmd):builder.build(vmd,object))},onProgress,onError)}},{key:\"loadWithAnimation\",value:function(modelUrl,vmdUrl,onLoad,onProgress,onError){var scope=\nthis;this.load(modelUrl,function(mesh){scope.loadAnimation(vmdUrl,mesh,function(animation){onLoad({mesh,animation})},onProgress,onError)},onProgress,onError)}},{key:\"loadPMD\",value:function(url,onLoad,onProgress,onError){var parser=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType(\"arraybuffer\").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(url,function(buffer){onLoad(parser.parsePmd(buffer,!0))},onProgress,onError)}},{key:\"loadPMX\",\nvalue:function(url,onLoad,onProgress,onError){var parser=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType(\"arraybuffer\").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(url,function(buffer){onLoad(parser.parsePmx(buffer,!0))},onProgress,onError)}},{key:\"loadVMD\",value:function(url,onLoad,onProgress,onError){url=Array.isArray(url)?url:[url];var vmds=[],vmdNum=url.length,parser=this._getParser();this.loader.setMimeType(void 0).setPath(this.animationPath).setResponseType(\"arraybuffer\").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials);\nfor(var i=0,il=url.length;i<il;i++)this.loader.load(url[i],function(buffer){vmds.push(parser.parseVmd(buffer,!0));vmds.length===vmdNum&&onLoad(parser.mergeVmds(vmds))},onProgress,onError)}},{key:\"loadVPD\",value:function(url,isUnicode,onLoad,onProgress,onError){var parser=this._getParser();this.loader.setMimeType(isUnicode?void 0:\"text/plain; charset\\x3dshift_jis\").setPath(this.animationPath).setResponseType(\"text\").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(url,\nfunction(text){onLoad(parser.parseVpd(text,!0))},onProgress,onError)}},{key:\"_extractExtension\",value:function(url){var index=url.lastIndexOf(\".\");return 0>index?\"\":url.slice(index+1)}},{key:\"_getParser\",value:function(){null===this.parser&&(this.parser=new _mmdParser.Parser);return this.parser}}]);return MMDLoader}(_three.Loader);exports.MMDLoader=global;var DEFAULT_TOON_TEXTURES=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII\\x3d data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg\\x3d\\x3d data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg\\x3d\\x3d data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg\\x3d\\x3d data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII\\x3d data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII\\x3d data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII\\x3d data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII\\x3d data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII\\x3d data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII\\x3d\".split(\" \"),\nMeshBuilder=function(){function MeshBuilder(manager){_classCallCheck(this,MeshBuilder);this.crossOrigin=\"anonymous\";this.geometryBuilder=new GeometryBuilder;this.materialBuilder=new MaterialBuilder(manager)}_createClass(MeshBuilder,[{key:\"setCrossOrigin\",value:function(crossOrigin){this.crossOrigin=crossOrigin;return this}},{key:\"build\",value:function(data,resourcePath,onProgress,onError){var geometry=this.geometryBuilder.build(data);data=this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(resourcePath).build(data,\ngeometry,onProgress,onError);geometry=new _three.SkinnedMesh(geometry,data);data=_three.Skeleton;resourcePath=geometry.geometry;onProgress=[];if(resourcePath&&void 0!==resourcePath.bones){onError=0;for(var il=resourcePath.bones.length;onError<il;onError++){var gbone=resourcePath.bones[onError],bone=new _three.Bone;onProgress.push(bone);bone.name=gbone.name;bone.position.fromArray(gbone.pos);bone.quaternion.fromArray(gbone.rotq);void 0!==gbone.scl&&bone.scale.fromArray(gbone.scl)}onError=0;for(il=\nresourcePath.bones.length;onError<il;onError++)gbone=resourcePath.bones[onError],-1!==gbone.parent&&null!==gbone.parent&&void 0!==onProgress[gbone.parent]?onProgress[gbone.parent].add(onProgress[onError]):geometry.add(onProgress[onError])}geometry.updateMatrixWorld(!0);data=new data(onProgress);geometry.bind(data);return geometry}}]);return MeshBuilder}(),GeometryBuilder=function(){function GeometryBuilder(){_classCallCheck(this,GeometryBuilder)}_createClass(GeometryBuilder,[{key:\"build\",value:function(data){function updateAttributes(attribute,\nmorph,ratio){for(var _i10=0;_i10<morph.elementCount;_i10++){var element=morph.elements[_i10];var index=\"pmd\"===data.metadata.format?data.morphs[0].elements[element.index].index:element.index;attribute.array[3*index]+=element.position[0]*ratio;attribute.array[3*index+1]+=element.position[1]*ratio;attribute.array[3*index+2]+=element.position[2]*ratio}}for(var positions=[],uvs=[],normals=[],indices=[],groups=[],bones=[],skinIndices=[],skinWeights=[],morphTargets=[],morphPositions=[],iks=[],grants=[],\nrigidBodies=[],constraints=[],offset=0,boneTypeTable={},i=0;i<data.metadata.vertexCount;i++){for(var v=data.vertices[i],j=0,jl=v.position.length;j<jl;j++)positions.push(v.position[j]);j=0;for(jl=v.normal.length;j<jl;j++)normals.push(v.normal[j]);j=0;for(jl=v.uv.length;j<jl;j++)uvs.push(v.uv[j]);for(j=0;4>j;j++)skinIndices.push(v.skinIndices.length-1>=j?v.skinIndices[j]:0);for(j=0;4>j;j++)skinWeights.push(v.skinWeights.length-1>=j?v.skinWeights[j]:0)}for(i=0;i<data.metadata.faceCount;i++)for(v=data.faces[i],\nj=0,jl=v.indices.length;j<jl;j++)indices.push(v.indices[j]);for(i=0;i<data.metadata.materialCount;i++)v=data.materials[i],groups.push({offset:3*offset,count:3*v.faceCount}),offset+=v.faceCount;for(offset=0;offset<data.metadata.rigidBodyCount;offset++)i=data.rigidBodies[offset],v=boneTypeTable[i.boneIndex],v=void 0===v?i.type:Math.max(i.type,v),boneTypeTable[i.boneIndex]=v;for(offset=0;offset<data.metadata.boneCount;offset++)i=data.bones[offset],i={index:offset,transformationClass:i.transformationClass,\nparent:i.parentIndex,name:i.name,pos:i.position.slice(0,3),rotq:[0,0,0,1],scl:[1,1,1],rigidBodyType:void 0!==boneTypeTable[offset]?boneTypeTable[offset]:-1},-1!==i.parent&&(i.pos[0]-=data.bones[i.parent].position[0],i.pos[1]-=data.bones[i.parent].position[1],i.pos[2]-=data.bones[i.parent].position[2]),bones.push(i);if(\"pmd\"===data.metadata.format)for(boneTypeTable=0;boneTypeTable<data.metadata.ikCount;boneTypeTable++){offset=data.iks[boneTypeTable];i={target:offset.target,effector:offset.effector,\niteration:offset.iteration,maxAngle:4*offset.maxAngle,links:[]};v=0;for(j=offset.links.length;v<j;v++)jl={},jl.index=offset.links[v].index,jl.enabled=!0,0<=data.bones[jl.index].name.indexOf(\"ひざ\")&&(jl.limitation=new _three.Vector3(1,0,0)),i.links.push(jl);iks.push(i)}else for(boneTypeTable=0;boneTypeTable<data.metadata.boneCount;boneTypeTable++)if(offset=data.bones[boneTypeTable].ik,void 0!==offset){i={target:boneTypeTable,effector:offset.effector,iteration:offset.iteration,maxAngle:offset.maxAngle,\nlinks:[]};v=0;for(j=offset.links.length;v<j;v++){jl={};jl.index=offset.links[v].index;jl.enabled=!0;if(1===offset.links[v].angleLimitation){var rotationMin=offset.links[v].lowerLimitationAngle,rotationMax=offset.links[v].upperLimitationAngle,tmp1=-rotationMax[0],tmp2=-rotationMax[1];rotationMax[0]=-rotationMin[0];rotationMax[1]=-rotationMin[1];rotationMin[0]=tmp1;rotationMin[1]=tmp2;jl.rotationMin=(new _three.Vector3).fromArray(rotationMin);jl.rotationMax=(new _three.Vector3).fromArray(rotationMax)}i.links.push(jl)}iks.push(i);\nbones[boneTypeTable].ik=i}if(\"pmx\"===data.metadata.format){boneTypeTable={};for(offset=0;offset<data.metadata.boneCount;offset++)i=data.bones[offset],v=i.grant,void 0!==v&&(boneTypeTable[offset]={parent:null,children:[],param:{index:offset,parentIndex:v.parentIndex,ratio:v.ratio,isLocal:v.isLocal,affectRotation:v.affectRotation,affectPosition:v.affectPosition,transformationClass:i.transformationClass},visited:!1});offset={parent:null,children:[],param:null,visited:!1};for(var boneIndex in boneTypeTable)i=\nboneTypeTable[boneIndex],v=boneTypeTable[i.parentIndex]||offset,i.parent=v,v.children.push(i);(function traverse(entry){entry.param&&(grants.push(entry.param),bones[entry.param.index].grant=entry.param);entry.visited=!0;for(var _i9=0,il=entry.children.length;_i9<il;_i9++){var child=entry.children[_i9];child.visited||traverse(child)}})(offset)}for(boneIndex=0;boneIndex<data.metadata.morphCount;boneIndex++){boneTypeTable=data.morphs[boneIndex];offset={name:boneTypeTable.name};i=new _three.Float32BufferAttribute(3*\ndata.metadata.vertexCount,3);i.name=boneTypeTable.name;for(v=0;v<3*data.metadata.vertexCount;v++)i.array[v]=positions[v];if(\"pmd\"===data.metadata.format)0!==boneIndex&&updateAttributes(i,boneTypeTable,1);else if(0===boneTypeTable.type)for(v=0;v<boneTypeTable.elementCount;v++)j=data.morphs[boneTypeTable.elements[v].index],jl=boneTypeTable.elements[v].ratio,1===j.type&&updateAttributes(i,j,jl);else 1===boneTypeTable.type&&updateAttributes(i,boneTypeTable,1);morphTargets.push(offset);morphPositions.push(i)}for(boneIndex=\n0;boneIndex<data.metadata.rigidBodyCount;boneIndex++){offset=data.rigidBodies[boneIndex];boneTypeTable={};for(var key in offset)boneTypeTable[key]=offset[key];\"pmx\"===data.metadata.format&&-1!==boneTypeTable.boneIndex&&(offset=data.bones[boneTypeTable.boneIndex],boneTypeTable.position[0]-=offset.position[0],boneTypeTable.position[1]-=offset.position[1],boneTypeTable.position[2]-=offset.position[2]);rigidBodies.push(boneTypeTable)}for(key=0;key<data.metadata.constraintCount;key++){boneTypeTable=data.constraints[key];\nboneIndex={};for(var _key in boneTypeTable)boneIndex[_key]=boneTypeTable[_key];boneTypeTable=rigidBodies[boneIndex.rigidBodyIndex1];offset=rigidBodies[boneIndex.rigidBodyIndex2];0!==boneTypeTable.type&&2===offset.type&&-1!==boneTypeTable.boneIndex&&-1!==offset.boneIndex&&data.bones[offset.boneIndex].parentIndex===boneTypeTable.boneIndex&&(offset.type=1);constraints.push(boneIndex)}_key=new _three.BufferGeometry;_key.setAttribute(\"position\",new _three.Float32BufferAttribute(positions,3));_key.setAttribute(\"normal\",\nnew _three.Float32BufferAttribute(normals,3));_key.setAttribute(\"uv\",new _three.Float32BufferAttribute(uvs,2));_key.setAttribute(\"skinIndex\",new _three.Uint16BufferAttribute(skinIndices,4));_key.setAttribute(\"skinWeight\",new _three.Float32BufferAttribute(skinWeights,4));_key.setIndex(indices);positions=0;for(uvs=groups.length;positions<uvs;positions++)_key.addGroup(groups[positions].offset,groups[positions].count,positions);_key.bones=bones;_key.morphTargets=morphTargets;_key.morphAttributes.position=\nmorphPositions;_key.morphTargetsRelative=!1;_key.userData.MMD={bones,iks,grants,rigidBodies,constraints,format:data.metadata.format};_key.computeBoundingSphere();return _key}}]);return GeometryBuilder}(),MaterialBuilder=function(){function MaterialBuilder(manager){_classCallCheck(this,MaterialBuilder);this.manager=manager;this.textureLoader=new _three.TextureLoader(this.manager);this.tgaLoader=null;this.crossOrigin=\"anonymous\";this.resourcePath=void 0}_createClass(MaterialBuilder,[{key:\"setCrossOrigin\",\nvalue:function(crossOrigin){this.crossOrigin=crossOrigin;return this}},{key:\"setResourcePath\",value:function(resourcePath){this.resourcePath=resourcePath;return this}},{key:\"build\",value:function(data,geometry){var materials$jscomp$0=[],textures={};this.textureLoader.setCrossOrigin(this.crossOrigin);for(var i=0;i<data.metadata.materialCount;i++){var material=data.materials[i],params={userData:{}};void 0!==material.name&&(params.name=material.name);params.color=(new _three.Color).fromArray(material.diffuse);\nparams.opacity=material.diffuse[3];params.emissive=(new _three.Color).fromArray(material.ambient);params.transparent=1!==params.opacity;params.skinning=0<geometry.bones.length?!0:!1;params.morphTargets=0<geometry.morphTargets.length?!0:!1;params.fog=!0;params.blending=_three.CustomBlending;params.blendSrc=_three.SrcAlphaFactor;params.blendDst=_three.OneMinusSrcAlphaFactor;params.blendSrcAlpha=_three.SrcAlphaFactor;params.blendDstAlpha=_three.DstAlphaFactor;params.side=\"pmx\"===data.metadata.format&&\n1===(material.flag&1)?_three.DoubleSide:1===params.opacity?_three.FrontSide:_three.DoubleSide;if(\"pmd\"===data.metadata.format){if(material.fileName){var fileNames=material.fileName.split(\"*\");params.map=this._loadTexture(fileNames[0],textures);if(1<fileNames.length){var extension=fileNames[1].slice(-4).toLowerCase();params.envMap=this._loadTexture(fileNames[1],textures);params.combine=\".sph\"===extension?_three.MultiplyOperation:_three.AddOperation}}fileNames=-1===material.toonIndex?\"toon00.bmp\":data.toonTextures[material.toonIndex].fileName;\nparams.gradientMap=this._loadTexture(fileNames,textures,{isToonTexture:!0,isDefaultToonTexture:this._isDefaultToonTexture(fileNames)});params.userData.outlineParameters={thickness:1===material.edgeFlag?.003:0,color:[0,0,0],alpha:1,visible:1===material.edgeFlag}}else-1!==material.textureIndex&&(params.map=this._loadTexture(data.textures[material.textureIndex],textures)),-1===material.envTextureIndex||1!==material.envFlag&&2!=material.envFlag||(params.envMap=this._loadTexture(data.textures[material.envTextureIndex],\ntextures),params.combine=1===material.envFlag?_three.MultiplyOperation:_three.AddOperation),extension=fileNames=void 0,-1===material.toonIndex||0!==material.toonFlag?(fileNames=\"toon\"+(\"0\"+(material.toonIndex+1)).slice(-2)+\".bmp\",extension=!0):(fileNames=data.textures[material.toonIndex],extension=!1),params.gradientMap=this._loadTexture(fileNames,textures,{isToonTexture:!0,isDefaultToonTexture:extension}),params.userData.outlineParameters={thickness:material.edgeSize/300,color:material.edgeColor.slice(0,\n3),alpha:material.edgeColor[3],visible:0!==(material.flag&16)&&0<material.edgeSize};void 0!==params.map&&(params.transparent||this._checkImageTransparency(params.map,geometry,i),params.emissive.multiplyScalar(.2));materials$jscomp$0.push(new _three.MeshToonMaterial(params))}if(\"pmx\"===data.metadata.format)for(geometry=function(elements,materials){for(var _i15=0,il=elements.length;_i15<il;_i15++){var element=elements[_i15];if(-1!==element.index){var _material=materials[element.index];_material.opacity!==\nelement.diffuse[3]&&(_material.transparent=!0)}}},textures=0,i=data.morphs.length;textures<i;textures++)if(params=data.morphs[textures],material=params.elements,0===params.type)for(params=0,fileNames=material.length;params<fileNames;params++)extension=data.morphs[material[params].index],8===extension.type&&geometry(extension.elements,materials$jscomp$0);else 8===params.type&&geometry(material,materials$jscomp$0);return materials$jscomp$0}},{key:\"_getTGALoader\",value:function(){if(null===this.tgaLoader){if(void 0===\n_TGALoader.TGALoader)throw Error(\"THREE.MMDLoader: Import TGALoader\");this.tgaLoader=new _TGALoader.TGALoader(this.manager)}return this.tgaLoader}},{key:\"_isDefaultToonTexture\",value:function(name){return 10!==name.length?!1:/toon(10|0[0-9])\\.bmp/.test(name)}},{key:\"_loadTexture\",value:function(filePath,textures,params,onProgress,onError){params=params||{};var scope=this;if(!0===params.isDefaultToonTexture){try{var fullPath=parseInt(filePath.match(/toon([0-9]{2})\\.bmp$/)[1])}catch(e){console.warn(\"THREE.MMDLoader: \"+\nfilePath+\" seems like a not right default texture path. Using toon00.bmp instead.\"),fullPath=0}fullPath=DEFAULT_TOON_TEXTURES[fullPath]}else fullPath=this.resourcePath+filePath;if(void 0!==textures[fullPath])return textures[fullPath];var loader=this.manager.getHandler(fullPath);null===loader&&(loader=\".tga\"===filePath.slice(-4).toLowerCase()?this._getTGALoader():this.textureLoader);var texture=loader.load(fullPath,function(t){!0===params.isToonTexture&&(t.image=scope._getRotatedImage(t.image),t.magFilter=\n_three.NearestFilter,t.minFilter=_three.NearestFilter);t.flipY=!1;t.wrapS=_three.RepeatWrapping;t.wrapT=_three.RepeatWrapping;for(t=0;t<texture.readyCallbacks.length;t++)texture.readyCallbacks[t](texture);delete texture.readyCallbacks},onProgress,onError);texture.readyCallbacks=[];return textures[fullPath]=texture}},{key:\"_getRotatedImage\",value:function(image){var canvas=document.createElement(\"canvas\"),context=canvas.getContext(\"2d\"),width=image.width,height=image.height;canvas.width=width;canvas.height=\nheight;context.clearRect(0,0,width,height);context.translate(width/2,height/2);context.rotate(.5*Math.PI);context.translate(-width/2,-height/2);context.drawImage(image,0,0);return context.getImageData(0,0,width,height)}},{key:\"_checkImageTransparency\",value:function(map,geometry,groupIndex){map.readyCallbacks.push(function(texture){function createImageData(image){var canvas=document.createElement(\"canvas\");canvas.width=image.width;canvas.height=image.height;var context=canvas.getContext(\"2d\");context.drawImage(image,\n0,0);return context.getImageData(0,0,canvas.width,canvas.height)}function getAlphaByUv(image,uv){var width=image.width,height=image.height,x=Math.round(uv.x*width)%width;uv=Math.round(uv.y*height)%height;0>x&&(x+=width);0>uv&&(uv+=height);return image.data[4*(uv*width+x)+3]}texture=void 0!==texture.image.data?texture.image:createImageData(texture.image);var group=geometry.groups[groupIndex];(function(image,uvs,indices){if(4!==image.data.length/(image.width*image.height))return!1;for(var i=0;i<indices.length;i+=\n3){for(var centerUV={x:0,y:0},j=0;3>j;j++){var index=indices[3*i+j];index={x:uvs[2*index],y:uvs[2*index+1]};if(253>getAlphaByUv(image,index))return!0;centerUV.x+=index.x;centerUV.y+=index.y}centerUV.x/=3;centerUV.y/=3;if(253>getAlphaByUv(image,centerUV))return!0}return!1})(texture,geometry.attributes.uv.array,geometry.index.array.slice(group.start,group.start+group.count))&&(map.transparent=!0)})}}]);return MaterialBuilder}(),AnimationBuilder=function(){function AnimationBuilder(){_classCallCheck(this,\nAnimationBuilder)}_createClass(AnimationBuilder,[{key:\"build\",value:function(vmd,mesh){var tracks=this.buildSkeletalAnimation(vmd,mesh).tracks;vmd=this.buildMorphAnimation(vmd,mesh).tracks;mesh=0;for(var il=vmd.length;mesh<il;mesh++)tracks.push(vmd[mesh]);return new _three.AnimationClip(\"\",-1,tracks)}},{key:\"buildSkeletalAnimation\",value:function(vmd,mesh){function pushInterpolation(array,interpolation,index){array.push(interpolation[index+0]/127);array.push(interpolation[index+8]/127);array.push(interpolation[index+\n4]/127);array.push(interpolation[index+12]/127)}for(var tracks=[],motions={},bones=mesh.skeleton.bones,boneNameDictionary={},i=0,il=bones.length;i<il;i++)boneNameDictionary[bones[i].name]=!0;for(bones=0;bones<vmd.metadata.motionCount;bones++)i=vmd.motions[bones],il=i.boneName,void 0!==boneNameDictionary[il]&&(motions[il]=motions[il]||[],motions[il].push(i));for(var key in motions){var array$jscomp$0=motions[key];array$jscomp$0.sort(function(a,b){return a.frameNum-b.frameNum});vmd=[];boneNameDictionary=\n[];bones=[];i=[];il=[];for(var basePosition=mesh.skeleton.getBoneByName(key).position.toArray(),_i18=0,_il2=array$jscomp$0.length;_i18<_il2;_i18++){var position=array$jscomp$0[_i18].position,rotation=array$jscomp$0[_i18].rotation,interpolation$jscomp$0=array$jscomp$0[_i18].interpolation;vmd.push(array$jscomp$0[_i18].frameNum/30);for(var j=0;3>j;j++)boneNameDictionary.push(basePosition[j]+position[j]);for(position=0;4>position;position++)bones.push(rotation[position]);for(rotation=0;3>rotation;rotation++)pushInterpolation(i,\ninterpolation$jscomp$0,rotation);pushInterpolation(il,interpolation$jscomp$0,3)}array$jscomp$0=\".bones[\"+key+\"]\";tracks.push(this._createTrack(array$jscomp$0+\".position\",_three.VectorKeyframeTrack,vmd,boneNameDictionary,i));tracks.push(this._createTrack(array$jscomp$0+\".quaternion\",_three.QuaternionKeyframeTrack,vmd,bones,il))}return new _three.AnimationClip(\"\",-1,tracks)}},{key:\"buildMorphAnimation\",value:function(vmd,mesh){var tracks=[],morphs={};mesh=mesh.morphTargetDictionary;for(var i=0;i<vmd.metadata.morphCount;i++){var morph=\nvmd.morphs[i],morphName=morph.morphName;void 0!==mesh[morphName]&&(morphs[morphName]=morphs[morphName]||[],morphs[morphName].push(morph))}for(var key in morphs){vmd=morphs[key];vmd.sort(function(a,b){return a.frameNum-b.frameNum});i=[];morph=[];morphName=0;for(var il=vmd.length;morphName<il;morphName++)i.push(vmd[morphName].frameNum/30),morph.push(vmd[morphName].weight);tracks.push(new _three.NumberKeyframeTrack(\".morphTargetInfluences[\"+mesh[key]+\"]\",i,morph))}return new _three.AnimationClip(\"\",\n-1,tracks)}},{key:\"buildCameraAnimation\",value:function(vmd){function pushVector3(array,vec){array.push(vec.x);array.push(vec.y);array.push(vec.z)}function pushQuaternion(array,q){array.push(q.x);array.push(q.y);array.push(q.z);array.push(q.w)}function pushInterpolation(array,interpolation,index){array.push(interpolation[4*index]/127);array.push(interpolation[4*index+1]/127);array.push(interpolation[4*index+2]/127);array.push(interpolation[4*index+3]/127)}var cameras=void 0===vmd.cameras?[]:vmd.cameras.slice();\ncameras.sort(function(a,b){return a.frameNum-b.frameNum});vmd=[];for(var centers=[],quaternions=[],positions=[],fovs=[],cInterpolations=[],qInterpolations=[],pInterpolations=[],fInterpolations=[],quaternion=new _three.Quaternion,euler=new _three.Euler,position=new _three.Vector3,center=new _three.Vector3,i=0,il=cameras.length;i<il;i++){var motion=cameras[i],pos=motion.position,rot=motion.rotation,distance=motion.distance,fov=motion.fov,interpolation$jscomp$0=motion.interpolation;vmd.push(motion.frameNum/\n30);position.set(0,0,-distance);center.set(pos[0],pos[1],pos[2]);euler.set(-rot[0],-rot[1],-rot[2]);quaternion.setFromEuler(euler);position.add(center);position.applyQuaternion(quaternion);pushVector3(centers,center);pushQuaternion(quaternions,quaternion);pushVector3(positions,position);fovs.push(fov);for(motion=0;3>motion;motion++)pushInterpolation(cInterpolations,interpolation$jscomp$0,motion);pushInterpolation(qInterpolations,interpolation$jscomp$0,3);for(motion=0;3>motion;motion++)pushInterpolation(pInterpolations,\ninterpolation$jscomp$0,4);pushInterpolation(fInterpolations,interpolation$jscomp$0,5)}cameras=[];cameras.push(this._createTrack(\"target.position\",_three.VectorKeyframeTrack,vmd,centers,cInterpolations));cameras.push(this._createTrack(\".quaternion\",_three.QuaternionKeyframeTrack,vmd,quaternions,qInterpolations));cameras.push(this._createTrack(\".position\",_three.VectorKeyframeTrack,vmd,positions,pInterpolations));cameras.push(this._createTrack(\".fov\",_three.NumberKeyframeTrack,vmd,fovs,fInterpolations));\nreturn new _three.AnimationClip(\"\",-1,cameras)}},{key:\"_createTrack\",value:function(node,typedKeyframeTrack,times,values,interpolations){if(2<times.length){times=times.slice();values=values.slice();interpolations=interpolations.slice();for(var stride=values.length/times.length,interpolateStride=interpolations.length/times.length,index=1,aheadIndex=2,endIndex=times.length;aheadIndex<endIndex;aheadIndex++){for(var i=0;i<stride;i++)if(values[index*stride+i]!==values[(index-1)*stride+i]||values[index*\nstride+i]!==values[aheadIndex*stride+i]){index++;break}if(aheadIndex>index){times[index]=times[aheadIndex];for(i=0;i<stride;i++)values[index*stride+i]=values[aheadIndex*stride+i];for(i=0;i<interpolateStride;i++)interpolations[index*interpolateStride+i]=interpolations[aheadIndex*interpolateStride+i]}}times.length=index+1;values.length=(index+1)*stride;interpolations.length=(index+1)*interpolateStride}node=new typedKeyframeTrack(node,times,values);node.createInterpolant=function(result){return new CubicBezierInterpolation(this.times,\nthis.values,this.getValueSize(),result,new Float32Array(interpolations))};return node}}]);return AnimationBuilder}(),CubicBezierInterpolation=function(_Interpolant){function CubicBezierInterpolation(parameterPositions,sampleValues,sampleSize,resultBuffer,params){_classCallCheck(this,CubicBezierInterpolation);parameterPositions=_possibleConstructorReturn(this,_getPrototypeOf(CubicBezierInterpolation).call(this,parameterPositions,sampleValues,sampleSize,resultBuffer));parameterPositions.interpolationParams=\nparams;return parameterPositions}_inherits(CubicBezierInterpolation,_Interpolant);_createClass(CubicBezierInterpolation,[{key:\"interpolate_\",value:function(i1,t0,t,t1){var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,params=this.interpolationParams,offset1=i1*stride,offset0=offset1-stride;t0=t1-t0<1/30*1.5?0:(t-t0)/(t1-t0);if(4===stride)i1=this._calculate(params[4*i1],params[4*i1+1],params[4*i1+2],params[4*i1+3],t0),_three.Quaternion.slerpFlat(result,0,values,offset0,values,\noffset1,i1);else if(3===stride)for(t=0;t!==stride;++t)t1=this._calculate(params[12*i1+4*t],params[12*i1+4*t+1],params[12*i1+4*t+2],params[12*i1+4*t+3],t0),result[t]=values[offset0+t]*(1-t1)+values[offset1+t]*t1;else i1=this._calculate(params[4*i1],params[4*i1+1],params[4*i1+2],params[4*i1+3],t0),result[0]=values[offset0]*(1-i1)+values[offset1]*i1;return result}},{key:\"_calculate\",value:function(x1,x2,y1,y2,x){for(var c=.5,t=c,s=1-t,math=Math,sst3,stt3,ttt,i=0;15>i;i++){sst3=3*s*s*t;stt3=3*s*t*t;ttt=\nt*t*t;s=sst3*x1+stt3*x2+ttt-x;if(1E-5>math.abs(s))break;c/=2;t+=0>s?c:-c;s=1-t}return sst3*y1+stt3*y2+ttt}}]);return CubicBezierInterpolation}(_three.Interpolant)}","~:source","shadow$provide[\"module$node_modules$three_stdlib$loaders$MMDLoader\"] = function(global,require,module,exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MMDLoader = void 0;\n\nvar _three = require(\"three\");\n\nvar _TGALoader = require(\"./TGALoader.js\");\n\nvar _mmdParser = require(\"mmd-parser\");\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\n/**\n * Dependencies\n *  - mmd-parser https://github.com/takahirox/mmd-parser\n *  - TGALoader\n *  - OutlineEffect\n *\n * MMDLoader creates Three.js Objects from MMD resources as\n * PMD, PMX, VMD, and VPD files.\n *\n * PMD/PMX is a model data format, VMD is a motion data format\n * VPD is a posing data format used in MMD(Miku Miku Dance).\n *\n * MMD official site\n *  - https://sites.google.com/view/evpvp/\n *\n * PMD, VMD format (in Japanese)\n *  - http://blog.goo.ne.jp/torisu_tetosuki/e/209ad341d3ece2b1b4df24abf619d6e4\n *\n * PMX format\n *  - https://gist.github.com/felixjones/f8a06bd48f9da9a4539f\n *\n * TODO\n *  - light motion in vmd support.\n *  - SDEF support.\n *  - uv/material/bone morphing support.\n *  - more precise grant skinning support.\n *  - shadow support.\n */\n\n/**\n * @param {THREE.LoadingManager} manager\n */\nvar MMDLoader =\n/*#__PURE__*/\nfunction (_Loader) {\n  _inherits(MMDLoader, _Loader);\n\n  function MMDLoader(manager) {\n    var _this;\n\n    _classCallCheck(this, MMDLoader);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(MMDLoader).call(this, manager));\n    _this.loader = new _three.FileLoader(_this.manager);\n    _this.parser = null; // lazy generation\n\n    _this.meshBuilder = new MeshBuilder(_this.manager);\n    _this.animationBuilder = new AnimationBuilder();\n    return _this;\n  }\n  /**\n   * @param {string} animationPath\n   * @return {MMDLoader}\n   */\n\n\n  _createClass(MMDLoader, [{\n    key: \"setAnimationPath\",\n    value: function setAnimationPath(animationPath) {\n      this.animationPath = animationPath;\n      return this;\n    } // Load MMD assets as Three.js Object\n\n    /**\n     * Loads Model file (.pmd or .pmx) as a SkinnedMesh.\n     *\n     * @param {string} url - url to Model(.pmd or .pmx) file\n     * @param {function} onLoad\n     * @param {function} onProgress\n     * @param {function} onError\n     */\n\n  }, {\n    key: \"load\",\n    value: function load(url, onLoad, onProgress, onError) {\n      var builder = this.meshBuilder.setCrossOrigin(this.crossOrigin); // resource path\n\n      var resourcePath;\n\n      if (this.resourcePath !== '') {\n        resourcePath = this.resourcePath;\n      } else if (this.path !== '') {\n        resourcePath = this.path;\n      } else {\n        resourcePath = _three.LoaderUtils.extractUrlBase(url);\n      }\n\n      var modelExtension = this._extractExtension(url).toLowerCase(); // Should I detect by seeing header?\n\n\n      if (modelExtension !== 'pmd' && modelExtension !== 'pmx') {\n        if (onError) onError(new Error('THREE.MMDLoader: Unknown model file extension .' + modelExtension + '.'));\n        return;\n      }\n\n      this[modelExtension === 'pmd' ? 'loadPMD' : 'loadPMX'](url, function (data) {\n        onLoad(builder.build(data, resourcePath, onProgress, onError));\n      }, onProgress, onError);\n    }\n    /**\n     * Loads Motion file(s) (.vmd) as a AnimationClip.\n     * If two or more files are specified, they'll be merged.\n     *\n     * @param {string|Array<string>} url - url(s) to animation(.vmd) file(s)\n     * @param {SkinnedMesh|THREE.Camera} object - tracks will be fitting to this object\n     * @param {function} onLoad\n     * @param {function} onProgress\n     * @param {function} onError\n     */\n\n  }, {\n    key: \"loadAnimation\",\n    value: function loadAnimation(url, object, onLoad, onProgress, onError) {\n      var builder = this.animationBuilder;\n      this.loadVMD(url, function (vmd) {\n        onLoad(object.isCamera ? builder.buildCameraAnimation(vmd) : builder.build(vmd, object));\n      }, onProgress, onError);\n    }\n    /**\n     * Loads mode file and motion file(s) as an object containing\n     * a SkinnedMesh and a AnimationClip.\n     * Tracks of AnimationClip are fitting to the model.\n     *\n     * @param {string} modelUrl - url to Model(.pmd or .pmx) file\n     * @param {string|Array{string}} vmdUrl - url(s) to animation(.vmd) file\n     * @param {function} onLoad\n     * @param {function} onProgress\n     * @param {function} onError\n     */\n\n  }, {\n    key: \"loadWithAnimation\",\n    value: function loadWithAnimation(modelUrl, vmdUrl, onLoad, onProgress, onError) {\n      var scope = this;\n      this.load(modelUrl, function (mesh) {\n        scope.loadAnimation(vmdUrl, mesh, function (animation) {\n          onLoad({\n            mesh: mesh,\n            animation: animation\n          });\n        }, onProgress, onError);\n      }, onProgress, onError);\n    } // Load MMD assets as Object data parsed by MMDParser\n\n    /**\n     * Loads .pmd file as an Object.\n     *\n     * @param {string} url - url to .pmd file\n     * @param {function} onLoad\n     * @param {function} onProgress\n     * @param {function} onError\n     */\n\n  }, {\n    key: \"loadPMD\",\n    value: function loadPMD(url, onLoad, onProgress, onError) {\n      var parser = this._getParser();\n\n      this.loader.setMimeType(undefined).setPath(this.path).setResponseType('arraybuffer').setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(url, function (buffer) {\n        onLoad(parser.parsePmd(buffer, true));\n      }, onProgress, onError);\n    }\n    /**\n     * Loads .pmx file as an Object.\n     *\n     * @param {string} url - url to .pmx file\n     * @param {function} onLoad\n     * @param {function} onProgress\n     * @param {function} onError\n     */\n\n  }, {\n    key: \"loadPMX\",\n    value: function loadPMX(url, onLoad, onProgress, onError) {\n      var parser = this._getParser();\n\n      this.loader.setMimeType(undefined).setPath(this.path).setResponseType('arraybuffer').setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(url, function (buffer) {\n        onLoad(parser.parsePmx(buffer, true));\n      }, onProgress, onError);\n    }\n    /**\n     * Loads .vmd file as an Object. If two or more files are specified\n     * they'll be merged.\n     *\n     * @param {string|Array<string>} url - url(s) to .vmd file(s)\n     * @param {function} onLoad\n     * @param {function} onProgress\n     * @param {function} onError\n     */\n\n  }, {\n    key: \"loadVMD\",\n    value: function loadVMD(url, onLoad, onProgress, onError) {\n      var urls = Array.isArray(url) ? url : [url];\n      var vmds = [];\n      var vmdNum = urls.length;\n\n      var parser = this._getParser();\n\n      this.loader.setMimeType(undefined).setPath(this.animationPath).setResponseType('arraybuffer').setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials);\n\n      for (var i = 0, il = urls.length; i < il; i++) {\n        this.loader.load(urls[i], function (buffer) {\n          vmds.push(parser.parseVmd(buffer, true));\n          if (vmds.length === vmdNum) onLoad(parser.mergeVmds(vmds));\n        }, onProgress, onError);\n      }\n    }\n    /**\n     * Loads .vpd file as an Object.\n     *\n     * @param {string} url - url to .vpd file\n     * @param {boolean} isUnicode\n     * @param {function} onLoad\n     * @param {function} onProgress\n     * @param {function} onError\n     */\n\n  }, {\n    key: \"loadVPD\",\n    value: function loadVPD(url, isUnicode, onLoad, onProgress, onError) {\n      var parser = this._getParser();\n\n      this.loader.setMimeType(isUnicode ? undefined : 'text/plain; charset=shift_jis').setPath(this.animationPath).setResponseType('text').setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(url, function (text) {\n        onLoad(parser.parseVpd(text, true));\n      }, onProgress, onError);\n    } // private methods\n\n  }, {\n    key: \"_extractExtension\",\n    value: function _extractExtension(url) {\n      var index = url.lastIndexOf('.');\n      return index < 0 ? '' : url.slice(index + 1);\n    }\n  }, {\n    key: \"_getParser\",\n    value: function _getParser() {\n      if (this.parser === null) {\n        this.parser = new _mmdParser.Parser(); // eslint-disable-line no-undef\n      }\n\n      return this.parser;\n    }\n  }]);\n\n  return MMDLoader;\n}(_three.Loader); // Utilities\n\n/*\n * base64 encoded defalut toon textures toon00.bmp - toon10.bmp.\n * We don't need to request external toon image files.\n * This idea is from http://www20.atpages.jp/katwat/three.js_r58/examples/mytest37/mmd.three.js\n */\n\n\nexports.MMDLoader = MMDLoader;\nvar DEFAULT_TOON_TEXTURES = ['data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=']; // Builders. They build Three.js object from Object data parsed by MMDParser.\n\n/**\n * @param {THREE.LoadingManager} manager\n */\n\nvar MeshBuilder =\n/*#__PURE__*/\nfunction () {\n  function MeshBuilder(manager) {\n    _classCallCheck(this, MeshBuilder);\n\n    this.crossOrigin = 'anonymous';\n    this.geometryBuilder = new GeometryBuilder();\n    this.materialBuilder = new MaterialBuilder(manager);\n  }\n  /**\n   * @param {string} crossOrigin\n   * @return {MeshBuilder}\n   */\n\n\n  _createClass(MeshBuilder, [{\n    key: \"setCrossOrigin\",\n    value: function setCrossOrigin(crossOrigin) {\n      this.crossOrigin = crossOrigin;\n      return this;\n    }\n    /**\n     * @param {Object} data - parsed PMD/PMX data\n     * @param {string} resourcePath\n     * @param {function} onProgress\n     * @param {function} onError\n     * @return {SkinnedMesh}\n     */\n\n  }, {\n    key: \"build\",\n    value: function build(data, resourcePath, onProgress, onError) {\n      var geometry = this.geometryBuilder.build(data);\n      var material = this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(resourcePath).build(data, geometry, onProgress, onError);\n      var mesh = new _three.SkinnedMesh(geometry, material);\n      var skeleton = new _three.Skeleton(initBones(mesh));\n      mesh.bind(skeleton); // console.log( mesh ); // for console debug\n\n      return mesh;\n    }\n  }]);\n\n  return MeshBuilder;\n}(); // TODO: Try to remove this function\n\n\nfunction initBones(mesh) {\n  var geometry = mesh.geometry;\n  var bones = [];\n\n  if (geometry && geometry.bones !== undefined) {\n    // first, create array of 'Bone' objects from geometry data\n    for (var i = 0, il = geometry.bones.length; i < il; i++) {\n      var gbone = geometry.bones[i]; // create new 'Bone' object\n\n      var bone = new _three.Bone();\n      bones.push(bone); // apply values\n\n      bone.name = gbone.name;\n      bone.position.fromArray(gbone.pos);\n      bone.quaternion.fromArray(gbone.rotq);\n      if (gbone.scl !== undefined) bone.scale.fromArray(gbone.scl);\n    } // second, create bone hierarchy\n\n\n    for (var _i = 0, _il = geometry.bones.length; _i < _il; _i++) {\n      var _gbone = geometry.bones[_i];\n\n      if (_gbone.parent !== -1 && _gbone.parent !== null && bones[_gbone.parent] !== undefined) {\n        // subsequent bones in the hierarchy\n        bones[_gbone.parent].add(bones[_i]);\n      } else {\n        // topmost bone, immediate child of the skinned mesh\n        mesh.add(bones[_i]);\n      }\n    }\n  } // now the bones are part of the scene graph and children of the skinned mesh.\n  // let's update the corresponding matrices\n\n\n  mesh.updateMatrixWorld(true);\n  return bones;\n} //\n\n\nvar GeometryBuilder =\n/*#__PURE__*/\nfunction () {\n  function GeometryBuilder() {\n    _classCallCheck(this, GeometryBuilder);\n  }\n\n  _createClass(GeometryBuilder, [{\n    key: \"build\",\n\n    /**\n     * @param {Object} data - parsed PMD/PMX data\n     * @return {BufferGeometry}\n     */\n    value: function build(data) {\n      // for geometry\n      var positions = [];\n      var uvs = [];\n      var normals = [];\n      var indices = [];\n      var groups = [];\n      var bones = [];\n      var skinIndices = [];\n      var skinWeights = [];\n      var morphTargets = [];\n      var morphPositions = [];\n      var iks = [];\n      var grants = [];\n      var rigidBodies = [];\n      var constraints = []; // for work\n\n      var offset = 0;\n      var boneTypeTable = {}; // positions, normals, uvs, skinIndices, skinWeights\n\n      for (var i = 0; i < data.metadata.vertexCount; i++) {\n        var v = data.vertices[i];\n\n        for (var j = 0, jl = v.position.length; j < jl; j++) {\n          positions.push(v.position[j]);\n        }\n\n        for (var _j = 0, _jl = v.normal.length; _j < _jl; _j++) {\n          normals.push(v.normal[_j]);\n        }\n\n        for (var _j2 = 0, _jl2 = v.uv.length; _j2 < _jl2; _j2++) {\n          uvs.push(v.uv[_j2]);\n        }\n\n        for (var _j3 = 0; _j3 < 4; _j3++) {\n          skinIndices.push(v.skinIndices.length - 1 >= _j3 ? v.skinIndices[_j3] : 0.0);\n        }\n\n        for (var _j4 = 0; _j4 < 4; _j4++) {\n          skinWeights.push(v.skinWeights.length - 1 >= _j4 ? v.skinWeights[_j4] : 0.0);\n        }\n      } // indices\n\n\n      for (var _i2 = 0; _i2 < data.metadata.faceCount; _i2++) {\n        var face = data.faces[_i2];\n\n        for (var _j5 = 0, _jl3 = face.indices.length; _j5 < _jl3; _j5++) {\n          indices.push(face.indices[_j5]);\n        }\n      } // groups\n\n\n      for (var _i3 = 0; _i3 < data.metadata.materialCount; _i3++) {\n        var material = data.materials[_i3];\n        groups.push({\n          offset: offset * 3,\n          count: material.faceCount * 3\n        });\n        offset += material.faceCount;\n      } // bones\n\n\n      for (var _i4 = 0; _i4 < data.metadata.rigidBodyCount; _i4++) {\n        var body = data.rigidBodies[_i4];\n        var value = boneTypeTable[body.boneIndex]; // keeps greater number if already value is set without any special reasons\n\n        value = value === undefined ? body.type : Math.max(body.type, value);\n        boneTypeTable[body.boneIndex] = value;\n      }\n\n      for (var _i5 = 0; _i5 < data.metadata.boneCount; _i5++) {\n        var boneData = data.bones[_i5];\n        var bone = {\n          index: _i5,\n          transformationClass: boneData.transformationClass,\n          parent: boneData.parentIndex,\n          name: boneData.name,\n          pos: boneData.position.slice(0, 3),\n          rotq: [0, 0, 0, 1],\n          scl: [1, 1, 1],\n          rigidBodyType: boneTypeTable[_i5] !== undefined ? boneTypeTable[_i5] : -1\n        };\n\n        if (bone.parent !== -1) {\n          bone.pos[0] -= data.bones[bone.parent].position[0];\n          bone.pos[1] -= data.bones[bone.parent].position[1];\n          bone.pos[2] -= data.bones[bone.parent].position[2];\n        }\n\n        bones.push(bone);\n      } // iks\n      // TODO: remove duplicated codes between PMD and PMX\n\n\n      if (data.metadata.format === 'pmd') {\n        for (var _i6 = 0; _i6 < data.metadata.ikCount; _i6++) {\n          var ik = data.iks[_i6];\n          var param = {\n            target: ik.target,\n            effector: ik.effector,\n            iteration: ik.iteration,\n            maxAngle: ik.maxAngle * 4,\n            links: []\n          };\n\n          for (var _j6 = 0, _jl4 = ik.links.length; _j6 < _jl4; _j6++) {\n            var link = {};\n            link.index = ik.links[_j6].index;\n            link.enabled = true;\n\n            if (data.bones[link.index].name.indexOf('ひざ') >= 0) {\n              link.limitation = new _three.Vector3(1.0, 0.0, 0.0);\n            }\n\n            param.links.push(link);\n          }\n\n          iks.push(param);\n        }\n      } else {\n        for (var _i7 = 0; _i7 < data.metadata.boneCount; _i7++) {\n          var _ik = data.bones[_i7].ik;\n          if (_ik === undefined) continue;\n          var _param = {\n            target: _i7,\n            effector: _ik.effector,\n            iteration: _ik.iteration,\n            maxAngle: _ik.maxAngle,\n            links: []\n          };\n\n          for (var _j7 = 0, _jl5 = _ik.links.length; _j7 < _jl5; _j7++) {\n            var _link = {};\n            _link.index = _ik.links[_j7].index;\n            _link.enabled = true;\n\n            if (_ik.links[_j7].angleLimitation === 1) {\n              // Revert if rotationMin/Max doesn't work well\n              // link.limitation = new Vector3( 1.0, 0.0, 0.0 );\n              var rotationMin = _ik.links[_j7].lowerLimitationAngle;\n              var rotationMax = _ik.links[_j7].upperLimitationAngle; // Convert Left to Right coordinate by myself because\n              // MMDParser doesn't convert. It's a MMDParser's bug\n\n              var tmp1 = -rotationMax[0];\n              var tmp2 = -rotationMax[1];\n              rotationMax[0] = -rotationMin[0];\n              rotationMax[1] = -rotationMin[1];\n              rotationMin[0] = tmp1;\n              rotationMin[1] = tmp2;\n              _link.rotationMin = new _three.Vector3().fromArray(rotationMin);\n              _link.rotationMax = new _three.Vector3().fromArray(rotationMax);\n            }\n\n            _param.links.push(_link);\n          }\n\n          iks.push(_param); // Save the reference even from bone data for efficiently\n          // simulating PMX animation system\n\n          bones[_i7].ik = _param;\n        }\n      } // grants\n\n\n      if (data.metadata.format === 'pmx') {\n        // Sort grant parameters from parents to children because\n        // grant uses parent's transform that parent's grant is already applied\n        // so grant should be applied in order from parents to children\n        var traverse = function traverse(entry) {\n          if (entry.param) {\n            grants.push(entry.param); // Save the reference even from bone data for efficiently\n            // simulating PMX animation system\n\n            bones[entry.param.index].grant = entry.param;\n          }\n\n          entry.visited = true;\n\n          for (var _i9 = 0, il = entry.children.length; _i9 < il; _i9++) {\n            var child = entry.children[_i9]; // Cut off a loop if exists. (Is a grant loop invalid?)\n\n            if (!child.visited) traverse(child);\n          }\n        };\n\n        // bone index -> grant entry map\n        var grantEntryMap = {};\n\n        for (var _i8 = 0; _i8 < data.metadata.boneCount; _i8++) {\n          var _boneData = data.bones[_i8];\n          var grant = _boneData.grant;\n          if (grant === undefined) continue;\n          var _param2 = {\n            index: _i8,\n            parentIndex: grant.parentIndex,\n            ratio: grant.ratio,\n            isLocal: grant.isLocal,\n            affectRotation: grant.affectRotation,\n            affectPosition: grant.affectPosition,\n            transformationClass: _boneData.transformationClass\n          };\n          grantEntryMap[_i8] = {\n            parent: null,\n            children: [],\n            param: _param2,\n            visited: false\n          };\n        }\n\n        var rootEntry = {\n          parent: null,\n          children: [],\n          param: null,\n          visited: false\n        }; // Build a tree representing grant hierarchy\n\n        for (var boneIndex in grantEntryMap) {\n          var grantEntry = grantEntryMap[boneIndex];\n          var parentGrantEntry = grantEntryMap[grantEntry.parentIndex] || rootEntry;\n          grantEntry.parent = parentGrantEntry;\n          parentGrantEntry.children.push(grantEntry);\n        }\n\n        traverse(rootEntry);\n      } // morph\n\n\n      function updateAttributes(attribute, morph, ratio) {\n        for (var _i10 = 0; _i10 < morph.elementCount; _i10++) {\n          var element = morph.elements[_i10];\n          var index = void 0;\n\n          if (data.metadata.format === 'pmd') {\n            index = data.morphs[0].elements[element.index].index;\n          } else {\n            index = element.index;\n          }\n\n          attribute.array[index * 3 + 0] += element.position[0] * ratio;\n          attribute.array[index * 3 + 1] += element.position[1] * ratio;\n          attribute.array[index * 3 + 2] += element.position[2] * ratio;\n        }\n      }\n\n      for (var _i11 = 0; _i11 < data.metadata.morphCount; _i11++) {\n        var morph = data.morphs[_i11];\n        var params = {\n          name: morph.name\n        };\n        var attribute = new _three.Float32BufferAttribute(data.metadata.vertexCount * 3, 3);\n        attribute.name = morph.name;\n\n        for (var _j8 = 0; _j8 < data.metadata.vertexCount * 3; _j8++) {\n          attribute.array[_j8] = positions[_j8];\n        }\n\n        if (data.metadata.format === 'pmd') {\n          if (_i11 !== 0) {\n            updateAttributes(attribute, morph, 1.0);\n          }\n        } else {\n          if (morph.type === 0) {\n            // group\n            for (var _j9 = 0; _j9 < morph.elementCount; _j9++) {\n              var morph2 = data.morphs[morph.elements[_j9].index];\n              var ratio = morph.elements[_j9].ratio;\n\n              if (morph2.type === 1) {\n                updateAttributes(attribute, morph2, ratio);\n              }\n            }\n          } else if (morph.type === 1) {\n            // vertex\n            updateAttributes(attribute, morph, 1.0);\n          } else if (morph.type === 2) ;else if (morph.type === 3) ;else if (morph.type === 4) ;else if (morph.type === 5) ;else if (morph.type === 6) ;else if (morph.type === 7) ;else if (morph.type === 8) ;\n        }\n\n        morphTargets.push(params);\n        morphPositions.push(attribute);\n      } // rigid bodies from rigidBodies field.\n\n\n      for (var _i12 = 0; _i12 < data.metadata.rigidBodyCount; _i12++) {\n        var rigidBody = data.rigidBodies[_i12];\n        var _params = {};\n\n        for (var key in rigidBody) {\n          _params[key] = rigidBody[key];\n        }\n        /*\n         * RigidBody position parameter in PMX seems global position\n         * while the one in PMD seems offset from corresponding bone.\n         * So unify being offset.\n         */\n\n\n        if (data.metadata.format === 'pmx') {\n          if (_params.boneIndex !== -1) {\n            var _bone = data.bones[_params.boneIndex];\n            _params.position[0] -= _bone.position[0];\n            _params.position[1] -= _bone.position[1];\n            _params.position[2] -= _bone.position[2];\n          }\n        }\n\n        rigidBodies.push(_params);\n      } // constraints from constraints field.\n\n\n      for (var _i13 = 0; _i13 < data.metadata.constraintCount; _i13++) {\n        var constraint = data.constraints[_i13];\n        var _params2 = {};\n\n        for (var _key in constraint) {\n          _params2[_key] = constraint[_key];\n        }\n\n        var bodyA = rigidBodies[_params2.rigidBodyIndex1];\n        var bodyB = rigidBodies[_params2.rigidBodyIndex2]; // Refer to http://www20.atpages.jp/katwat/wp/?p=4135\n\n        if (bodyA.type !== 0 && bodyB.type === 2) {\n          if (bodyA.boneIndex !== -1 && bodyB.boneIndex !== -1 && data.bones[bodyB.boneIndex].parentIndex === bodyA.boneIndex) {\n            bodyB.type = 1;\n          }\n        }\n\n        constraints.push(_params2);\n      } // build BufferGeometry.\n\n\n      var geometry = new _three.BufferGeometry();\n      geometry.setAttribute('position', new _three.Float32BufferAttribute(positions, 3));\n      geometry.setAttribute('normal', new _three.Float32BufferAttribute(normals, 3));\n      geometry.setAttribute('uv', new _three.Float32BufferAttribute(uvs, 2));\n      geometry.setAttribute('skinIndex', new _three.Uint16BufferAttribute(skinIndices, 4));\n      geometry.setAttribute('skinWeight', new _three.Float32BufferAttribute(skinWeights, 4));\n      geometry.setIndex(indices);\n\n      for (var _i14 = 0, il = groups.length; _i14 < il; _i14++) {\n        geometry.addGroup(groups[_i14].offset, groups[_i14].count, _i14);\n      }\n\n      geometry.bones = bones;\n      geometry.morphTargets = morphTargets;\n      geometry.morphAttributes.position = morphPositions;\n      geometry.morphTargetsRelative = false;\n      geometry.userData.MMD = {\n        bones: bones,\n        iks: iks,\n        grants: grants,\n        rigidBodies: rigidBodies,\n        constraints: constraints,\n        format: data.metadata.format\n      };\n      geometry.computeBoundingSphere();\n      return geometry;\n    }\n  }]);\n\n  return GeometryBuilder;\n}(); //\n\n/**\n * @param {THREE.LoadingManager} manager\n */\n\n\nvar MaterialBuilder =\n/*#__PURE__*/\nfunction () {\n  function MaterialBuilder(manager) {\n    _classCallCheck(this, MaterialBuilder);\n\n    this.manager = manager;\n    this.textureLoader = new _three.TextureLoader(this.manager);\n    this.tgaLoader = null; // lazy generation\n\n    this.crossOrigin = 'anonymous';\n    this.resourcePath = undefined;\n  }\n  /**\n   * @param {string} crossOrigin\n   * @return {MaterialBuilder}\n   */\n\n\n  _createClass(MaterialBuilder, [{\n    key: \"setCrossOrigin\",\n    value: function setCrossOrigin(crossOrigin) {\n      this.crossOrigin = crossOrigin;\n      return this;\n    }\n    /**\n     * @param {string} resourcePath\n     * @return {MaterialBuilder}\n     */\n\n  }, {\n    key: \"setResourcePath\",\n    value: function setResourcePath(resourcePath) {\n      this.resourcePath = resourcePath;\n      return this;\n    }\n    /**\n     * @param {Object} data - parsed PMD/PMX data\n     * @param {BufferGeometry} geometry - some properties are dependend on geometry\n     * @param {function} onProgress\n     * @param {function} onError\n     * @return {Array<MeshToonMaterial>}\n     */\n\n  }, {\n    key: \"build\",\n    value: function build(data, geometry\n    /*, onProgress, onError */\n    ) {\n      var materials = [];\n      var textures = {};\n      this.textureLoader.setCrossOrigin(this.crossOrigin); // materials\n\n      for (var i = 0; i < data.metadata.materialCount; i++) {\n        var material = data.materials[i];\n        var params = {\n          userData: {}\n        };\n        if (material.name !== undefined) params.name = material.name;\n        /*\n         * Color\n         *\n         * MMD         MeshToonMaterial\n         * diffuse  -  color\n         * ambient  -  emissive * a\n         *               (a = 1.0 without map texture or 0.2 with map texture)\n         *\n         * MeshToonMaterial doesn't have ambient. Set it to emissive instead.\n         * It'll be too bright if material has map texture so using coef 0.2.\n         */\n\n        params.color = new _three.Color().fromArray(material.diffuse);\n        params.opacity = material.diffuse[3];\n        params.emissive = new _three.Color().fromArray(material.ambient);\n        params.transparent = params.opacity !== 1.0; //\n\n        params.skinning = geometry.bones.length > 0 ? true : false;\n        params.morphTargets = geometry.morphTargets.length > 0 ? true : false;\n        params.fog = true; // blend\n\n        params.blending = _three.CustomBlending;\n        params.blendSrc = _three.SrcAlphaFactor;\n        params.blendDst = _three.OneMinusSrcAlphaFactor;\n        params.blendSrcAlpha = _three.SrcAlphaFactor;\n        params.blendDstAlpha = _three.DstAlphaFactor; // side\n\n        if (data.metadata.format === 'pmx' && (material.flag & 0x1) === 1) {\n          params.side = _three.DoubleSide;\n        } else {\n          params.side = params.opacity === 1.0 ? _three.FrontSide : _three.DoubleSide;\n        }\n\n        if (data.metadata.format === 'pmd') {\n          // map, envMap\n          if (material.fileName) {\n            var fileName = material.fileName;\n            var fileNames = fileName.split('*'); // fileNames[ 0 ]: mapFileName\n            // fileNames[ 1 ]: envMapFileName( optional )\n\n            params.map = this._loadTexture(fileNames[0], textures);\n\n            if (fileNames.length > 1) {\n              var extension = fileNames[1].slice(-4).toLowerCase();\n              params.envMap = this._loadTexture(fileNames[1], textures);\n              params.combine = extension === '.sph' ? _three.MultiplyOperation : _three.AddOperation;\n            }\n          } // gradientMap\n\n\n          var toonFileName = material.toonIndex === -1 ? 'toon00.bmp' : data.toonTextures[material.toonIndex].fileName;\n          params.gradientMap = this._loadTexture(toonFileName, textures, {\n            isToonTexture: true,\n            isDefaultToonTexture: this._isDefaultToonTexture(toonFileName)\n          }); // parameters for OutlineEffect\n\n          params.userData.outlineParameters = {\n            thickness: material.edgeFlag === 1 ? 0.003 : 0.0,\n            color: [0, 0, 0],\n            alpha: 1.0,\n            visible: material.edgeFlag === 1\n          };\n        } else {\n          // map\n          if (material.textureIndex !== -1) {\n            params.map = this._loadTexture(data.textures[material.textureIndex], textures);\n          } // envMap TODO: support m.envFlag === 3\n\n\n          if (material.envTextureIndex !== -1 && (material.envFlag === 1 || material.envFlag == 2)) {\n            params.envMap = this._loadTexture(data.textures[material.envTextureIndex], textures);\n            params.combine = material.envFlag === 1 ? _three.MultiplyOperation : _three.AddOperation;\n          } // gradientMap\n\n\n          var _toonFileName = void 0,\n              isDefaultToon = void 0;\n\n          if (material.toonIndex === -1 || material.toonFlag !== 0) {\n            _toonFileName = 'toon' + ('0' + (material.toonIndex + 1)).slice(-2) + '.bmp';\n            isDefaultToon = true;\n          } else {\n            _toonFileName = data.textures[material.toonIndex];\n            isDefaultToon = false;\n          }\n\n          params.gradientMap = this._loadTexture(_toonFileName, textures, {\n            isToonTexture: true,\n            isDefaultToonTexture: isDefaultToon\n          }); // parameters for OutlineEffect\n\n          params.userData.outlineParameters = {\n            thickness: material.edgeSize / 300,\n            // TODO: better calculation?\n            color: material.edgeColor.slice(0, 3),\n            alpha: material.edgeColor[3],\n            visible: (material.flag & 0x10) !== 0 && material.edgeSize > 0.0\n          };\n        }\n\n        if (params.map !== undefined) {\n          if (!params.transparent) {\n            this._checkImageTransparency(params.map, geometry, i);\n          }\n\n          params.emissive.multiplyScalar(0.2);\n        }\n\n        materials.push(new _three.MeshToonMaterial(params));\n      }\n\n      if (data.metadata.format === 'pmx') {\n        // set transparent true if alpha morph is defined.\n        var checkAlphaMorph = function checkAlphaMorph(elements, materials) {\n          for (var _i15 = 0, il = elements.length; _i15 < il; _i15++) {\n            var element = elements[_i15];\n            if (element.index === -1) continue;\n            var _material = materials[element.index];\n\n            if (_material.opacity !== element.diffuse[3]) {\n              _material.transparent = true;\n            }\n          }\n        };\n\n        for (var _i16 = 0, il = data.morphs.length; _i16 < il; _i16++) {\n          var morph = data.morphs[_i16];\n          var elements = morph.elements;\n\n          if (morph.type === 0) {\n            for (var j = 0, jl = elements.length; j < jl; j++) {\n              var morph2 = data.morphs[elements[j].index];\n              if (morph2.type !== 8) continue;\n              checkAlphaMorph(morph2.elements, materials);\n            }\n          } else if (morph.type === 8) {\n            checkAlphaMorph(elements, materials);\n          }\n        }\n      }\n\n      return materials;\n    } // private methods\n\n  }, {\n    key: \"_getTGALoader\",\n    value: function _getTGALoader() {\n      if (this.tgaLoader === null) {\n        if (_TGALoader.TGALoader === undefined) {\n          throw new Error('THREE.MMDLoader: Import TGALoader');\n        }\n\n        this.tgaLoader = new _TGALoader.TGALoader(this.manager);\n      }\n\n      return this.tgaLoader;\n    }\n  }, {\n    key: \"_isDefaultToonTexture\",\n    value: function _isDefaultToonTexture(name) {\n      if (name.length !== 10) return false;\n      return /toon(10|0[0-9])\\.bmp/.test(name);\n    }\n  }, {\n    key: \"_loadTexture\",\n    value: function _loadTexture(filePath, textures, params, onProgress, onError) {\n      params = params || {};\n      var scope = this;\n      var fullPath;\n\n      if (params.isDefaultToonTexture === true) {\n        var index;\n\n        try {\n          index = parseInt(filePath.match(/toon([0-9]{2})\\.bmp$/)[1]);\n        } catch (e) {\n          console.warn('THREE.MMDLoader: ' + filePath + ' seems like a ' + 'not right default texture path. Using toon00.bmp instead.');\n          index = 0;\n        }\n\n        fullPath = DEFAULT_TOON_TEXTURES[index];\n      } else {\n        fullPath = this.resourcePath + filePath;\n      }\n\n      if (textures[fullPath] !== undefined) return textures[fullPath];\n      var loader = this.manager.getHandler(fullPath);\n\n      if (loader === null) {\n        loader = filePath.slice(-4).toLowerCase() === '.tga' ? this._getTGALoader() : this.textureLoader;\n      }\n\n      var texture = loader.load(fullPath, function (t) {\n        // MMD toon texture is Axis-Y oriented\n        // but Three.js gradient map is Axis-X oriented.\n        // So here replaces the toon texture image with the rotated one.\n        if (params.isToonTexture === true) {\n          t.image = scope._getRotatedImage(t.image);\n          t.magFilter = _three.NearestFilter;\n          t.minFilter = _three.NearestFilter;\n        }\n\n        t.flipY = false;\n        t.wrapS = _three.RepeatWrapping;\n        t.wrapT = _three.RepeatWrapping;\n\n        for (var i = 0; i < texture.readyCallbacks.length; i++) {\n          texture.readyCallbacks[i](texture);\n        }\n\n        delete texture.readyCallbacks;\n      }, onProgress, onError);\n      texture.readyCallbacks = [];\n      textures[fullPath] = texture;\n      return texture;\n    }\n  }, {\n    key: \"_getRotatedImage\",\n    value: function _getRotatedImage(image) {\n      var canvas = document.createElement('canvas');\n      var context = canvas.getContext('2d');\n      var width = image.width;\n      var height = image.height;\n      canvas.width = width;\n      canvas.height = height;\n      context.clearRect(0, 0, width, height);\n      context.translate(width / 2.0, height / 2.0);\n      context.rotate(0.5 * Math.PI); // 90.0 * Math.PI / 180.0\n\n      context.translate(-width / 2.0, -height / 2.0);\n      context.drawImage(image, 0, 0);\n      return context.getImageData(0, 0, width, height);\n    } // Check if the partial image area used by the texture is transparent.\n\n  }, {\n    key: \"_checkImageTransparency\",\n    value: function _checkImageTransparency(map, geometry, groupIndex) {\n      map.readyCallbacks.push(function (texture) {\n        // Is there any efficient ways?\n        function createImageData(image) {\n          var canvas = document.createElement('canvas');\n          canvas.width = image.width;\n          canvas.height = image.height;\n          var context = canvas.getContext('2d');\n          context.drawImage(image, 0, 0);\n          return context.getImageData(0, 0, canvas.width, canvas.height);\n        }\n\n        function detectImageTransparency(image, uvs, indices) {\n          var width = image.width;\n          var height = image.height;\n          var data = image.data;\n          var threshold = 253;\n          if (data.length / (width * height) !== 4) return false;\n\n          for (var i = 0; i < indices.length; i += 3) {\n            var centerUV = {\n              x: 0.0,\n              y: 0.0\n            };\n\n            for (var j = 0; j < 3; j++) {\n              var index = indices[i * 3 + j];\n              var uv = {\n                x: uvs[index * 2 + 0],\n                y: uvs[index * 2 + 1]\n              };\n              if (getAlphaByUv(image, uv) < threshold) return true;\n              centerUV.x += uv.x;\n              centerUV.y += uv.y;\n            }\n\n            centerUV.x /= 3;\n            centerUV.y /= 3;\n            if (getAlphaByUv(image, centerUV) < threshold) return true;\n          }\n\n          return false;\n        }\n        /*\n         * This method expects\n         *   texture.flipY = false\n         *   texture.wrapS = RepeatWrapping\n         *   texture.wrapT = RepeatWrapping\n         * TODO: more precise\n         */\n\n\n        function getAlphaByUv(image, uv) {\n          var width = image.width;\n          var height = image.height;\n          var x = Math.round(uv.x * width) % width;\n          var y = Math.round(uv.y * height) % height;\n          if (x < 0) x += width;\n          if (y < 0) y += height;\n          var index = y * width + x;\n          return image.data[index * 4 + 3];\n        }\n\n        var imageData = texture.image.data !== undefined ? texture.image : createImageData(texture.image);\n        var group = geometry.groups[groupIndex];\n\n        if (detectImageTransparency(imageData, geometry.attributes.uv.array, geometry.index.array.slice(group.start, group.start + group.count))) {\n          map.transparent = true;\n        }\n      });\n    }\n  }]);\n\n  return MaterialBuilder;\n}(); //\n\n\nvar AnimationBuilder =\n/*#__PURE__*/\nfunction () {\n  function AnimationBuilder() {\n    _classCallCheck(this, AnimationBuilder);\n  }\n\n  _createClass(AnimationBuilder, [{\n    key: \"build\",\n\n    /**\n     * @param {Object} vmd - parsed VMD data\n     * @param {SkinnedMesh} mesh - tracks will be fitting to mesh\n     * @return {AnimationClip}\n     */\n    value: function build(vmd, mesh) {\n      // combine skeletal and morph animations\n      var tracks = this.buildSkeletalAnimation(vmd, mesh).tracks;\n      var tracks2 = this.buildMorphAnimation(vmd, mesh).tracks;\n\n      for (var i = 0, il = tracks2.length; i < il; i++) {\n        tracks.push(tracks2[i]);\n      }\n\n      return new _three.AnimationClip('', -1, tracks);\n    }\n    /**\n     * @param {Object} vmd - parsed VMD data\n     * @param {SkinnedMesh} mesh - tracks will be fitting to mesh\n     * @return {AnimationClip}\n     */\n\n  }, {\n    key: \"buildSkeletalAnimation\",\n    value: function buildSkeletalAnimation(vmd, mesh) {\n      function pushInterpolation(array, interpolation, index) {\n        array.push(interpolation[index + 0] / 127); // x1\n\n        array.push(interpolation[index + 8] / 127); // x2\n\n        array.push(interpolation[index + 4] / 127); // y1\n\n        array.push(interpolation[index + 12] / 127); // y2\n      }\n\n      var tracks = [];\n      var motions = {};\n      var bones = mesh.skeleton.bones;\n      var boneNameDictionary = {};\n\n      for (var i = 0, il = bones.length; i < il; i++) {\n        boneNameDictionary[bones[i].name] = true;\n      }\n\n      for (var _i17 = 0; _i17 < vmd.metadata.motionCount; _i17++) {\n        var motion = vmd.motions[_i17];\n        var boneName = motion.boneName;\n        if (boneNameDictionary[boneName] === undefined) continue;\n        motions[boneName] = motions[boneName] || [];\n        motions[boneName].push(motion);\n      }\n\n      for (var key in motions) {\n        var array = motions[key];\n        array.sort(function (a, b) {\n          return a.frameNum - b.frameNum;\n        });\n        var times = [];\n        var positions = [];\n        var rotations = [];\n        var pInterpolations = [];\n        var rInterpolations = [];\n        var basePosition = mesh.skeleton.getBoneByName(key).position.toArray();\n\n        for (var _i18 = 0, _il2 = array.length; _i18 < _il2; _i18++) {\n          var time = array[_i18].frameNum / 30;\n          var position = array[_i18].position;\n          var rotation = array[_i18].rotation;\n          var interpolation = array[_i18].interpolation;\n          times.push(time);\n\n          for (var j = 0; j < 3; j++) {\n            positions.push(basePosition[j] + position[j]);\n          }\n\n          for (var _j10 = 0; _j10 < 4; _j10++) {\n            rotations.push(rotation[_j10]);\n          }\n\n          for (var _j11 = 0; _j11 < 3; _j11++) {\n            pushInterpolation(pInterpolations, interpolation, _j11);\n          }\n\n          pushInterpolation(rInterpolations, interpolation, 3);\n        }\n\n        var targetName = '.bones[' + key + ']';\n        tracks.push(this._createTrack(targetName + '.position', _three.VectorKeyframeTrack, times, positions, pInterpolations));\n        tracks.push(this._createTrack(targetName + '.quaternion', _three.QuaternionKeyframeTrack, times, rotations, rInterpolations));\n      }\n\n      return new _three.AnimationClip('', -1, tracks);\n    }\n    /**\n     * @param {Object} vmd - parsed VMD data\n     * @param {SkinnedMesh} mesh - tracks will be fitting to mesh\n     * @return {AnimationClip}\n     */\n\n  }, {\n    key: \"buildMorphAnimation\",\n    value: function buildMorphAnimation(vmd, mesh) {\n      var tracks = [];\n      var morphs = {};\n      var morphTargetDictionary = mesh.morphTargetDictionary;\n\n      for (var i = 0; i < vmd.metadata.morphCount; i++) {\n        var morph = vmd.morphs[i];\n        var morphName = morph.morphName;\n        if (morphTargetDictionary[morphName] === undefined) continue;\n        morphs[morphName] = morphs[morphName] || [];\n        morphs[morphName].push(morph);\n      }\n\n      for (var key in morphs) {\n        var array = morphs[key];\n        array.sort(function (a, b) {\n          return a.frameNum - b.frameNum;\n        });\n        var times = [];\n        var values = [];\n\n        for (var _i19 = 0, il = array.length; _i19 < il; _i19++) {\n          times.push(array[_i19].frameNum / 30);\n          values.push(array[_i19].weight);\n        }\n\n        tracks.push(new _three.NumberKeyframeTrack('.morphTargetInfluences[' + morphTargetDictionary[key] + ']', times, values));\n      }\n\n      return new _three.AnimationClip('', -1, tracks);\n    }\n    /**\n     * @param {Object} vmd - parsed VMD data\n     * @return {AnimationClip}\n     */\n\n  }, {\n    key: \"buildCameraAnimation\",\n    value: function buildCameraAnimation(vmd) {\n      function pushVector3(array, vec) {\n        array.push(vec.x);\n        array.push(vec.y);\n        array.push(vec.z);\n      }\n\n      function pushQuaternion(array, q) {\n        array.push(q.x);\n        array.push(q.y);\n        array.push(q.z);\n        array.push(q.w);\n      }\n\n      function pushInterpolation(array, interpolation, index) {\n        array.push(interpolation[index * 4 + 0] / 127); // x1\n\n        array.push(interpolation[index * 4 + 1] / 127); // x2\n\n        array.push(interpolation[index * 4 + 2] / 127); // y1\n\n        array.push(interpolation[index * 4 + 3] / 127); // y2\n      }\n\n      var cameras = vmd.cameras === undefined ? [] : vmd.cameras.slice();\n      cameras.sort(function (a, b) {\n        return a.frameNum - b.frameNum;\n      });\n      var times = [];\n      var centers = [];\n      var quaternions = [];\n      var positions = [];\n      var fovs = [];\n      var cInterpolations = [];\n      var qInterpolations = [];\n      var pInterpolations = [];\n      var fInterpolations = [];\n      var quaternion = new _three.Quaternion();\n      var euler = new _three.Euler();\n      var position = new _three.Vector3();\n      var center = new _three.Vector3();\n\n      for (var i = 0, il = cameras.length; i < il; i++) {\n        var motion = cameras[i];\n        var time = motion.frameNum / 30;\n        var pos = motion.position;\n        var rot = motion.rotation;\n        var distance = motion.distance;\n        var fov = motion.fov;\n        var interpolation = motion.interpolation;\n        times.push(time);\n        position.set(0, 0, -distance);\n        center.set(pos[0], pos[1], pos[2]);\n        euler.set(-rot[0], -rot[1], -rot[2]);\n        quaternion.setFromEuler(euler);\n        position.add(center);\n        position.applyQuaternion(quaternion);\n        pushVector3(centers, center);\n        pushQuaternion(quaternions, quaternion);\n        pushVector3(positions, position);\n        fovs.push(fov);\n\n        for (var j = 0; j < 3; j++) {\n          pushInterpolation(cInterpolations, interpolation, j);\n        }\n\n        pushInterpolation(qInterpolations, interpolation, 3); // use the same parameter for x, y, z axis.\n\n        for (var _j12 = 0; _j12 < 3; _j12++) {\n          pushInterpolation(pInterpolations, interpolation, 4);\n        }\n\n        pushInterpolation(fInterpolations, interpolation, 5);\n      }\n\n      var tracks = []; // I expect an object whose name 'target' exists under THREE.Camera\n\n      tracks.push(this._createTrack('target.position', _three.VectorKeyframeTrack, times, centers, cInterpolations));\n      tracks.push(this._createTrack('.quaternion', _three.QuaternionKeyframeTrack, times, quaternions, qInterpolations));\n      tracks.push(this._createTrack('.position', _three.VectorKeyframeTrack, times, positions, pInterpolations));\n      tracks.push(this._createTrack('.fov', _three.NumberKeyframeTrack, times, fovs, fInterpolations));\n      return new _three.AnimationClip('', -1, tracks);\n    } // private method\n\n  }, {\n    key: \"_createTrack\",\n    value: function _createTrack(node, typedKeyframeTrack, times, values, interpolations) {\n      /*\n       * optimizes here not to let KeyframeTrackPrototype optimize\n       * because KeyframeTrackPrototype optimizes times and values but\n       * doesn't optimize interpolations.\n       */\n      if (times.length > 2) {\n        times = times.slice();\n        values = values.slice();\n        interpolations = interpolations.slice();\n        var stride = values.length / times.length;\n        var interpolateStride = interpolations.length / times.length;\n        var index = 1;\n\n        for (var aheadIndex = 2, endIndex = times.length; aheadIndex < endIndex; aheadIndex++) {\n          for (var i = 0; i < stride; i++) {\n            if (values[index * stride + i] !== values[(index - 1) * stride + i] || values[index * stride + i] !== values[aheadIndex * stride + i]) {\n              index++;\n              break;\n            }\n          }\n\n          if (aheadIndex > index) {\n            times[index] = times[aheadIndex];\n\n            for (var _i20 = 0; _i20 < stride; _i20++) {\n              values[index * stride + _i20] = values[aheadIndex * stride + _i20];\n            }\n\n            for (var _i21 = 0; _i21 < interpolateStride; _i21++) {\n              interpolations[index * interpolateStride + _i21] = interpolations[aheadIndex * interpolateStride + _i21];\n            }\n          }\n        }\n\n        times.length = index + 1;\n        values.length = (index + 1) * stride;\n        interpolations.length = (index + 1) * interpolateStride;\n      }\n\n      var track = new typedKeyframeTrack(node, times, values);\n\n      track.createInterpolant = function InterpolantFactoryMethodCubicBezier(result) {\n        return new CubicBezierInterpolation(this.times, this.values, this.getValueSize(), result, new Float32Array(interpolations));\n      };\n\n      return track;\n    }\n  }]);\n\n  return AnimationBuilder;\n}(); // interpolation\n\n\nvar CubicBezierInterpolation =\n/*#__PURE__*/\nfunction (_Interpolant) {\n  _inherits(CubicBezierInterpolation, _Interpolant);\n\n  function CubicBezierInterpolation(parameterPositions, sampleValues, sampleSize, resultBuffer, params) {\n    var _this2;\n\n    _classCallCheck(this, CubicBezierInterpolation);\n\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(CubicBezierInterpolation).call(this, parameterPositions, sampleValues, sampleSize, resultBuffer));\n    _this2.interpolationParams = params;\n    return _this2;\n  }\n\n  _createClass(CubicBezierInterpolation, [{\n    key: \"interpolate_\",\n    value: function interpolate_(i1, t0, t, t1) {\n      var result = this.resultBuffer;\n      var values = this.sampleValues;\n      var stride = this.valueSize;\n      var params = this.interpolationParams;\n      var offset1 = i1 * stride;\n      var offset0 = offset1 - stride; // No interpolation if next key frame is in one frame in 30fps.\n      // This is from MMD animation spec.\n      // '1.5' is for precision loss. times are Float32 in Three.js Animation system.\n\n      var weight1 = t1 - t0 < 1 / 30 * 1.5 ? 0.0 : (t - t0) / (t1 - t0);\n\n      if (stride === 4) {\n        // Quaternion\n        var x1 = params[i1 * 4 + 0];\n        var x2 = params[i1 * 4 + 1];\n        var y1 = params[i1 * 4 + 2];\n        var y2 = params[i1 * 4 + 3];\n\n        var ratio = this._calculate(x1, x2, y1, y2, weight1);\n\n        _three.Quaternion.slerpFlat(result, 0, values, offset0, values, offset1, ratio);\n      } else if (stride === 3) {\n        // Vector3\n        for (var i = 0; i !== stride; ++i) {\n          var _x = params[i1 * 12 + i * 4 + 0];\n          var _x2 = params[i1 * 12 + i * 4 + 1];\n          var _y = params[i1 * 12 + i * 4 + 2];\n          var _y2 = params[i1 * 12 + i * 4 + 3];\n\n          var _ratio = this._calculate(_x, _x2, _y, _y2, weight1);\n\n          result[i] = values[offset0 + i] * (1 - _ratio) + values[offset1 + i] * _ratio;\n        }\n      } else {\n        // Number\n        var _x3 = params[i1 * 4 + 0];\n        var _x4 = params[i1 * 4 + 1];\n        var _y3 = params[i1 * 4 + 2];\n        var _y4 = params[i1 * 4 + 3];\n\n        var _ratio2 = this._calculate(_x3, _x4, _y3, _y4, weight1);\n\n        result[0] = values[offset0] * (1 - _ratio2) + values[offset1] * _ratio2;\n      }\n\n      return result;\n    }\n  }, {\n    key: \"_calculate\",\n    value: function _calculate(x1, x2, y1, y2, x) {\n      /*\n       * Cubic Bezier curves\n       *   https://en.wikipedia.org/wiki/B%C3%A9zier_curve#Cubic_B.C3.A9zier_curves\n       *\n       * B(t) = ( 1 - t ) ^ 3 * P0\n       *      + 3 * ( 1 - t ) ^ 2 * t * P1\n       *      + 3 * ( 1 - t ) * t^2 * P2\n       *      + t ^ 3 * P3\n       *      ( 0 <= t <= 1 )\n       *\n       * MMD uses Cubic Bezier curves for bone and camera animation interpolation.\n       *   http://d.hatena.ne.jp/edvakf/20111016/1318716097\n       *\n       *    x = ( 1 - t ) ^ 3 * x0\n       *      + 3 * ( 1 - t ) ^ 2 * t * x1\n       *      + 3 * ( 1 - t ) * t^2 * x2\n       *      + t ^ 3 * x3\n       *    y = ( 1 - t ) ^ 3 * y0\n       *      + 3 * ( 1 - t ) ^ 2 * t * y1\n       *      + 3 * ( 1 - t ) * t^2 * y2\n       *      + t ^ 3 * y3\n       *      ( x0 = 0, y0 = 0 )\n       *      ( x3 = 1, y3 = 1 )\n       *      ( 0 <= t, x1, x2, y1, y2 <= 1 )\n       *\n       * Here solves this equation with Bisection method,\n       *   https://en.wikipedia.org/wiki/Bisection_method\n       * gets t, and then calculate y.\n       *\n       * f(t) = 3 * ( 1 - t ) ^ 2 * t * x1\n       *      + 3 * ( 1 - t ) * t^2 * x2\n       *      + t ^ 3 - x = 0\n       *\n       * (Another option: Newton's method\n       *    https://en.wikipedia.org/wiki/Newton%27s_method)\n       */\n      var c = 0.5;\n      var t = c;\n      var s = 1.0 - t;\n      var loop = 15;\n      var eps = 1e-5;\n      var math = Math;\n      var sst3, stt3, ttt;\n\n      for (var i = 0; i < loop; i++) {\n        sst3 = 3.0 * s * s * t;\n        stt3 = 3.0 * s * t * t;\n        ttt = t * t * t;\n        var ft = sst3 * x1 + stt3 * x2 + ttt - x;\n        if (math.abs(ft) < eps) break;\n        c /= 2.0;\n        t += ft < 0 ? c : -c;\n        s = 1.0 - t;\n      }\n\n      return sst3 * y1 + stt3 * y2 + ttt;\n    }\n  }]);\n\n  return CubicBezierInterpolation;\n}(_three.Interpolant);\n};","~:removed-requires",["~#set",[]],"~:actual-requires",["^5",["~$module$node_modules$three$build$three_module","~$module$node_modules$three_stdlib$loaders$TGALoader","~$shadow.js","~$module$node_modules$mmd_parser$build$mmdparser"]],"~:properties",["^5",["materialBuilder","resourcePath","map","isLocal","wrapS","parser","width","pos","affectRotation","iks","ratio","animationBuilder","blending","index","isToonTexture","offset","prototype","height","skinning","transparent","effector","textureLoader","side","outlineParameters","constraints","gradientMap","interpolationParams","image","createInterpolant","isDefaultToonTexture","fog","emissive","limitation","readyCallbacks","key","parent","children","x","__esModule","blendDstAlpha","grant","enabled","meshBuilder","count","animationPath","transformationClass","position","parentIndex","loader","name","configurable","animation","value","blendSrcAlpha","visible","enumerable","param","userData","magFilter","iteration","writable","MMD","blendDst","scl","length","links","grants","ik","bones","rotationMax","mesh","type","y","wrapT","blendSrc","__proto__","target","alpha","affectPosition","envMap","manager","rigidBodyType","rotationMin","morphTargetsRelative","morphTargets","rotq","combine","minFilter","maxAngle","flipY","thickness","MMDLoader","color","tgaLoader","opacity","crossOrigin","geometryBuilder","visited","format","rigidBodies","constructor"]],"~:compiled-at",1630917515927,"~:source-map-json","{\n\"version\":3,\n\"file\":\"module$node_modules$three_stdlib$loaders$MMDLoader.js\",\n\"lineCount\":55,\n\"mappings\":\"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\",\n\"sources\":[\"node_modules/three-stdlib/loaders/MMDLoader.js\"],\n\"sourcesContent\":[\"shadow$provide[\\\"module$node_modules$three_stdlib$loaders$MMDLoader\\\"] = function(global,require,module,exports) {\\n\\\"use strict\\\";\\n\\nObject.defineProperty(exports, \\\"__esModule\\\", {\\n  value: true\\n});\\nexports.MMDLoader = void 0;\\n\\nvar _three = require(\\\"three\\\");\\n\\nvar _TGALoader = require(\\\"./TGALoader.js\\\");\\n\\nvar _mmdParser = require(\\\"mmd-parser\\\");\\n\\nfunction _typeof(obj) { if (typeof Symbol === \\\"function\\\" && typeof Symbol.iterator === \\\"symbol\\\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \\\"function\\\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \\\"symbol\\\" : typeof obj; }; } return _typeof(obj); }\\n\\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\\\"Cannot call a class as a function\\\"); } }\\n\\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\\\"value\\\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\\n\\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\\n\\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \\\"object\\\" || typeof call === \\\"function\\\")) { return call; } return _assertThisInitialized(self); }\\n\\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\\\"this hasn't been initialised - super() hasn't been called\\\"); } return self; }\\n\\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\\n\\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \\\"function\\\" && superClass !== null) { throw new TypeError(\\\"Super expression must either be null or a function\\\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\\n\\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\\n\\n/**\\n * Dependencies\\n *  - mmd-parser https://github.com/takahirox/mmd-parser\\n *  - TGALoader\\n *  - OutlineEffect\\n *\\n * MMDLoader creates Three.js Objects from MMD resources as\\n * PMD, PMX, VMD, and VPD files.\\n *\\n * PMD/PMX is a model data format, VMD is a motion data format\\n * VPD is a posing data format used in MMD(Miku Miku Dance).\\n *\\n * MMD official site\\n *  - https://sites.google.com/view/evpvp/\\n *\\n * PMD, VMD format (in Japanese)\\n *  - http://blog.goo.ne.jp/torisu_tetosuki/e/209ad341d3ece2b1b4df24abf619d6e4\\n *\\n * PMX format\\n *  - https://gist.github.com/felixjones/f8a06bd48f9da9a4539f\\n *\\n * TODO\\n *  - light motion in vmd support.\\n *  - SDEF support.\\n *  - uv/material/bone morphing support.\\n *  - more precise grant skinning support.\\n *  - shadow support.\\n */\\n\\n/**\\n * @param {THREE.LoadingManager} manager\\n */\\nvar MMDLoader =\\n/*#__PURE__*/\\nfunction (_Loader) {\\n  _inherits(MMDLoader, _Loader);\\n\\n  function MMDLoader(manager) {\\n    var _this;\\n\\n    _classCallCheck(this, MMDLoader);\\n\\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(MMDLoader).call(this, manager));\\n    _this.loader = new _three.FileLoader(_this.manager);\\n    _this.parser = null; // lazy generation\\n\\n    _this.meshBuilder = new MeshBuilder(_this.manager);\\n    _this.animationBuilder = new AnimationBuilder();\\n    return _this;\\n  }\\n  /**\\n   * @param {string} animationPath\\n   * @return {MMDLoader}\\n   */\\n\\n\\n  _createClass(MMDLoader, [{\\n    key: \\\"setAnimationPath\\\",\\n    value: function setAnimationPath(animationPath) {\\n      this.animationPath = animationPath;\\n      return this;\\n    } // Load MMD assets as Three.js Object\\n\\n    /**\\n     * Loads Model file (.pmd or .pmx) as a SkinnedMesh.\\n     *\\n     * @param {string} url - url to Model(.pmd or .pmx) file\\n     * @param {function} onLoad\\n     * @param {function} onProgress\\n     * @param {function} onError\\n     */\\n\\n  }, {\\n    key: \\\"load\\\",\\n    value: function load(url, onLoad, onProgress, onError) {\\n      var builder = this.meshBuilder.setCrossOrigin(this.crossOrigin); // resource path\\n\\n      var resourcePath;\\n\\n      if (this.resourcePath !== '') {\\n        resourcePath = this.resourcePath;\\n      } else if (this.path !== '') {\\n        resourcePath = this.path;\\n      } else {\\n        resourcePath = _three.LoaderUtils.extractUrlBase(url);\\n      }\\n\\n      var modelExtension = this._extractExtension(url).toLowerCase(); // Should I detect by seeing header?\\n\\n\\n      if (modelExtension !== 'pmd' && modelExtension !== 'pmx') {\\n        if (onError) onError(new Error('THREE.MMDLoader: Unknown model file extension .' + modelExtension + '.'));\\n        return;\\n      }\\n\\n      this[modelExtension === 'pmd' ? 'loadPMD' : 'loadPMX'](url, function (data) {\\n        onLoad(builder.build(data, resourcePath, onProgress, onError));\\n      }, onProgress, onError);\\n    }\\n    /**\\n     * Loads Motion file(s) (.vmd) as a AnimationClip.\\n     * If two or more files are specified, they'll be merged.\\n     *\\n     * @param {string|Array<string>} url - url(s) to animation(.vmd) file(s)\\n     * @param {SkinnedMesh|THREE.Camera} object - tracks will be fitting to this object\\n     * @param {function} onLoad\\n     * @param {function} onProgress\\n     * @param {function} onError\\n     */\\n\\n  }, {\\n    key: \\\"loadAnimation\\\",\\n    value: function loadAnimation(url, object, onLoad, onProgress, onError) {\\n      var builder = this.animationBuilder;\\n      this.loadVMD(url, function (vmd) {\\n        onLoad(object.isCamera ? builder.buildCameraAnimation(vmd) : builder.build(vmd, object));\\n      }, onProgress, onError);\\n    }\\n    /**\\n     * Loads mode file and motion file(s) as an object containing\\n     * a SkinnedMesh and a AnimationClip.\\n     * Tracks of AnimationClip are fitting to the model.\\n     *\\n     * @param {string} modelUrl - url to Model(.pmd or .pmx) file\\n     * @param {string|Array{string}} vmdUrl - url(s) to animation(.vmd) file\\n     * @param {function} onLoad\\n     * @param {function} onProgress\\n     * @param {function} onError\\n     */\\n\\n  }, {\\n    key: \\\"loadWithAnimation\\\",\\n    value: function loadWithAnimation(modelUrl, vmdUrl, onLoad, onProgress, onError) {\\n      var scope = this;\\n      this.load(modelUrl, function (mesh) {\\n        scope.loadAnimation(vmdUrl, mesh, function (animation) {\\n          onLoad({\\n            mesh: mesh,\\n            animation: animation\\n          });\\n        }, onProgress, onError);\\n      }, onProgress, onError);\\n    } // Load MMD assets as Object data parsed by MMDParser\\n\\n    /**\\n     * Loads .pmd file as an Object.\\n     *\\n     * @param {string} url - url to .pmd file\\n     * @param {function} onLoad\\n     * @param {function} onProgress\\n     * @param {function} onError\\n     */\\n\\n  }, {\\n    key: \\\"loadPMD\\\",\\n    value: function loadPMD(url, onLoad, onProgress, onError) {\\n      var parser = this._getParser();\\n\\n      this.loader.setMimeType(undefined).setPath(this.path).setResponseType('arraybuffer').setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(url, function (buffer) {\\n        onLoad(parser.parsePmd(buffer, true));\\n      }, onProgress, onError);\\n    }\\n    /**\\n     * Loads .pmx file as an Object.\\n     *\\n     * @param {string} url - url to .pmx file\\n     * @param {function} onLoad\\n     * @param {function} onProgress\\n     * @param {function} onError\\n     */\\n\\n  }, {\\n    key: \\\"loadPMX\\\",\\n    value: function loadPMX(url, onLoad, onProgress, onError) {\\n      var parser = this._getParser();\\n\\n      this.loader.setMimeType(undefined).setPath(this.path).setResponseType('arraybuffer').setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(url, function (buffer) {\\n        onLoad(parser.parsePmx(buffer, true));\\n      }, onProgress, onError);\\n    }\\n    /**\\n     * Loads .vmd file as an Object. If two or more files are specified\\n     * they'll be merged.\\n     *\\n     * @param {string|Array<string>} url - url(s) to .vmd file(s)\\n     * @param {function} onLoad\\n     * @param {function} onProgress\\n     * @param {function} onError\\n     */\\n\\n  }, {\\n    key: \\\"loadVMD\\\",\\n    value: function loadVMD(url, onLoad, onProgress, onError) {\\n      var urls = Array.isArray(url) ? url : [url];\\n      var vmds = [];\\n      var vmdNum = urls.length;\\n\\n      var parser = this._getParser();\\n\\n      this.loader.setMimeType(undefined).setPath(this.animationPath).setResponseType('arraybuffer').setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials);\\n\\n      for (var i = 0, il = urls.length; i < il; i++) {\\n        this.loader.load(urls[i], function (buffer) {\\n          vmds.push(parser.parseVmd(buffer, true));\\n          if (vmds.length === vmdNum) onLoad(parser.mergeVmds(vmds));\\n        }, onProgress, onError);\\n      }\\n    }\\n    /**\\n     * Loads .vpd file as an Object.\\n     *\\n     * @param {string} url - url to .vpd file\\n     * @param {boolean} isUnicode\\n     * @param {function} onLoad\\n     * @param {function} onProgress\\n     * @param {function} onError\\n     */\\n\\n  }, {\\n    key: \\\"loadVPD\\\",\\n    value: function loadVPD(url, isUnicode, onLoad, onProgress, onError) {\\n      var parser = this._getParser();\\n\\n      this.loader.setMimeType(isUnicode ? undefined : 'text/plain; charset=shift_jis').setPath(this.animationPath).setResponseType('text').setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(url, function (text) {\\n        onLoad(parser.parseVpd(text, true));\\n      }, onProgress, onError);\\n    } // private methods\\n\\n  }, {\\n    key: \\\"_extractExtension\\\",\\n    value: function _extractExtension(url) {\\n      var index = url.lastIndexOf('.');\\n      return index < 0 ? '' : url.slice(index + 1);\\n    }\\n  }, {\\n    key: \\\"_getParser\\\",\\n    value: function _getParser() {\\n      if (this.parser === null) {\\n        this.parser = new _mmdParser.Parser(); // eslint-disable-line no-undef\\n      }\\n\\n      return this.parser;\\n    }\\n  }]);\\n\\n  return MMDLoader;\\n}(_three.Loader); // Utilities\\n\\n/*\\n * base64 encoded defalut toon textures toon00.bmp - toon10.bmp.\\n * We don't need to request external toon image files.\\n * This idea is from http://www20.atpages.jp/katwat/three.js_r58/examples/mytest37/mmd.three.js\\n */\\n\\n\\nexports.MMDLoader = MMDLoader;\\nvar DEFAULT_TOON_TEXTURES = ['data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=']; // Builders. They build Three.js object from Object data parsed by MMDParser.\\n\\n/**\\n * @param {THREE.LoadingManager} manager\\n */\\n\\nvar MeshBuilder =\\n/*#__PURE__*/\\nfunction () {\\n  function MeshBuilder(manager) {\\n    _classCallCheck(this, MeshBuilder);\\n\\n    this.crossOrigin = 'anonymous';\\n    this.geometryBuilder = new GeometryBuilder();\\n    this.materialBuilder = new MaterialBuilder(manager);\\n  }\\n  /**\\n   * @param {string} crossOrigin\\n   * @return {MeshBuilder}\\n   */\\n\\n\\n  _createClass(MeshBuilder, [{\\n    key: \\\"setCrossOrigin\\\",\\n    value: function setCrossOrigin(crossOrigin) {\\n      this.crossOrigin = crossOrigin;\\n      return this;\\n    }\\n    /**\\n     * @param {Object} data - parsed PMD/PMX data\\n     * @param {string} resourcePath\\n     * @param {function} onProgress\\n     * @param {function} onError\\n     * @return {SkinnedMesh}\\n     */\\n\\n  }, {\\n    key: \\\"build\\\",\\n    value: function build(data, resourcePath, onProgress, onError) {\\n      var geometry = this.geometryBuilder.build(data);\\n      var material = this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(resourcePath).build(data, geometry, onProgress, onError);\\n      var mesh = new _three.SkinnedMesh(geometry, material);\\n      var skeleton = new _three.Skeleton(initBones(mesh));\\n      mesh.bind(skeleton); // console.log( mesh ); // for console debug\\n\\n      return mesh;\\n    }\\n  }]);\\n\\n  return MeshBuilder;\\n}(); // TODO: Try to remove this function\\n\\n\\nfunction initBones(mesh) {\\n  var geometry = mesh.geometry;\\n  var bones = [];\\n\\n  if (geometry && geometry.bones !== undefined) {\\n    // first, create array of 'Bone' objects from geometry data\\n    for (var i = 0, il = geometry.bones.length; i < il; i++) {\\n      var gbone = geometry.bones[i]; // create new 'Bone' object\\n\\n      var bone = new _three.Bone();\\n      bones.push(bone); // apply values\\n\\n      bone.name = gbone.name;\\n      bone.position.fromArray(gbone.pos);\\n      bone.quaternion.fromArray(gbone.rotq);\\n      if (gbone.scl !== undefined) bone.scale.fromArray(gbone.scl);\\n    } // second, create bone hierarchy\\n\\n\\n    for (var _i = 0, _il = geometry.bones.length; _i < _il; _i++) {\\n      var _gbone = geometry.bones[_i];\\n\\n      if (_gbone.parent !== -1 && _gbone.parent !== null && bones[_gbone.parent] !== undefined) {\\n        // subsequent bones in the hierarchy\\n        bones[_gbone.parent].add(bones[_i]);\\n      } else {\\n        // topmost bone, immediate child of the skinned mesh\\n        mesh.add(bones[_i]);\\n      }\\n    }\\n  } // now the bones are part of the scene graph and children of the skinned mesh.\\n  // let's update the corresponding matrices\\n\\n\\n  mesh.updateMatrixWorld(true);\\n  return bones;\\n} //\\n\\n\\nvar GeometryBuilder =\\n/*#__PURE__*/\\nfunction () {\\n  function GeometryBuilder() {\\n    _classCallCheck(this, GeometryBuilder);\\n  }\\n\\n  _createClass(GeometryBuilder, [{\\n    key: \\\"build\\\",\\n\\n    /**\\n     * @param {Object} data - parsed PMD/PMX data\\n     * @return {BufferGeometry}\\n     */\\n    value: function build(data) {\\n      // for geometry\\n      var positions = [];\\n      var uvs = [];\\n      var normals = [];\\n      var indices = [];\\n      var groups = [];\\n      var bones = [];\\n      var skinIndices = [];\\n      var skinWeights = [];\\n      var morphTargets = [];\\n      var morphPositions = [];\\n      var iks = [];\\n      var grants = [];\\n      var rigidBodies = [];\\n      var constraints = []; // for work\\n\\n      var offset = 0;\\n      var boneTypeTable = {}; // positions, normals, uvs, skinIndices, skinWeights\\n\\n      for (var i = 0; i < data.metadata.vertexCount; i++) {\\n        var v = data.vertices[i];\\n\\n        for (var j = 0, jl = v.position.length; j < jl; j++) {\\n          positions.push(v.position[j]);\\n        }\\n\\n        for (var _j = 0, _jl = v.normal.length; _j < _jl; _j++) {\\n          normals.push(v.normal[_j]);\\n        }\\n\\n        for (var _j2 = 0, _jl2 = v.uv.length; _j2 < _jl2; _j2++) {\\n          uvs.push(v.uv[_j2]);\\n        }\\n\\n        for (var _j3 = 0; _j3 < 4; _j3++) {\\n          skinIndices.push(v.skinIndices.length - 1 >= _j3 ? v.skinIndices[_j3] : 0.0);\\n        }\\n\\n        for (var _j4 = 0; _j4 < 4; _j4++) {\\n          skinWeights.push(v.skinWeights.length - 1 >= _j4 ? v.skinWeights[_j4] : 0.0);\\n        }\\n      } // indices\\n\\n\\n      for (var _i2 = 0; _i2 < data.metadata.faceCount; _i2++) {\\n        var face = data.faces[_i2];\\n\\n        for (var _j5 = 0, _jl3 = face.indices.length; _j5 < _jl3; _j5++) {\\n          indices.push(face.indices[_j5]);\\n        }\\n      } // groups\\n\\n\\n      for (var _i3 = 0; _i3 < data.metadata.materialCount; _i3++) {\\n        var material = data.materials[_i3];\\n        groups.push({\\n          offset: offset * 3,\\n          count: material.faceCount * 3\\n        });\\n        offset += material.faceCount;\\n      } // bones\\n\\n\\n      for (var _i4 = 0; _i4 < data.metadata.rigidBodyCount; _i4++) {\\n        var body = data.rigidBodies[_i4];\\n        var value = boneTypeTable[body.boneIndex]; // keeps greater number if already value is set without any special reasons\\n\\n        value = value === undefined ? body.type : Math.max(body.type, value);\\n        boneTypeTable[body.boneIndex] = value;\\n      }\\n\\n      for (var _i5 = 0; _i5 < data.metadata.boneCount; _i5++) {\\n        var boneData = data.bones[_i5];\\n        var bone = {\\n          index: _i5,\\n          transformationClass: boneData.transformationClass,\\n          parent: boneData.parentIndex,\\n          name: boneData.name,\\n          pos: boneData.position.slice(0, 3),\\n          rotq: [0, 0, 0, 1],\\n          scl: [1, 1, 1],\\n          rigidBodyType: boneTypeTable[_i5] !== undefined ? boneTypeTable[_i5] : -1\\n        };\\n\\n        if (bone.parent !== -1) {\\n          bone.pos[0] -= data.bones[bone.parent].position[0];\\n          bone.pos[1] -= data.bones[bone.parent].position[1];\\n          bone.pos[2] -= data.bones[bone.parent].position[2];\\n        }\\n\\n        bones.push(bone);\\n      } // iks\\n      // TODO: remove duplicated codes between PMD and PMX\\n\\n\\n      if (data.metadata.format === 'pmd') {\\n        for (var _i6 = 0; _i6 < data.metadata.ikCount; _i6++) {\\n          var ik = data.iks[_i6];\\n          var param = {\\n            target: ik.target,\\n            effector: ik.effector,\\n            iteration: ik.iteration,\\n            maxAngle: ik.maxAngle * 4,\\n            links: []\\n          };\\n\\n          for (var _j6 = 0, _jl4 = ik.links.length; _j6 < _jl4; _j6++) {\\n            var link = {};\\n            link.index = ik.links[_j6].index;\\n            link.enabled = true;\\n\\n            if (data.bones[link.index].name.indexOf('\\u3072\\u3056') >= 0) {\\n              link.limitation = new _three.Vector3(1.0, 0.0, 0.0);\\n            }\\n\\n            param.links.push(link);\\n          }\\n\\n          iks.push(param);\\n        }\\n      } else {\\n        for (var _i7 = 0; _i7 < data.metadata.boneCount; _i7++) {\\n          var _ik = data.bones[_i7].ik;\\n          if (_ik === undefined) continue;\\n          var _param = {\\n            target: _i7,\\n            effector: _ik.effector,\\n            iteration: _ik.iteration,\\n            maxAngle: _ik.maxAngle,\\n            links: []\\n          };\\n\\n          for (var _j7 = 0, _jl5 = _ik.links.length; _j7 < _jl5; _j7++) {\\n            var _link = {};\\n            _link.index = _ik.links[_j7].index;\\n            _link.enabled = true;\\n\\n            if (_ik.links[_j7].angleLimitation === 1) {\\n              // Revert if rotationMin/Max doesn't work well\\n              // link.limitation = new Vector3( 1.0, 0.0, 0.0 );\\n              var rotationMin = _ik.links[_j7].lowerLimitationAngle;\\n              var rotationMax = _ik.links[_j7].upperLimitationAngle; // Convert Left to Right coordinate by myself because\\n              // MMDParser doesn't convert. It's a MMDParser's bug\\n\\n              var tmp1 = -rotationMax[0];\\n              var tmp2 = -rotationMax[1];\\n              rotationMax[0] = -rotationMin[0];\\n              rotationMax[1] = -rotationMin[1];\\n              rotationMin[0] = tmp1;\\n              rotationMin[1] = tmp2;\\n              _link.rotationMin = new _three.Vector3().fromArray(rotationMin);\\n              _link.rotationMax = new _three.Vector3().fromArray(rotationMax);\\n            }\\n\\n            _param.links.push(_link);\\n          }\\n\\n          iks.push(_param); // Save the reference even from bone data for efficiently\\n          // simulating PMX animation system\\n\\n          bones[_i7].ik = _param;\\n        }\\n      } // grants\\n\\n\\n      if (data.metadata.format === 'pmx') {\\n        // Sort grant parameters from parents to children because\\n        // grant uses parent's transform that parent's grant is already applied\\n        // so grant should be applied in order from parents to children\\n        var traverse = function traverse(entry) {\\n          if (entry.param) {\\n            grants.push(entry.param); // Save the reference even from bone data for efficiently\\n            // simulating PMX animation system\\n\\n            bones[entry.param.index].grant = entry.param;\\n          }\\n\\n          entry.visited = true;\\n\\n          for (var _i9 = 0, il = entry.children.length; _i9 < il; _i9++) {\\n            var child = entry.children[_i9]; // Cut off a loop if exists. (Is a grant loop invalid?)\\n\\n            if (!child.visited) traverse(child);\\n          }\\n        };\\n\\n        // bone index -> grant entry map\\n        var grantEntryMap = {};\\n\\n        for (var _i8 = 0; _i8 < data.metadata.boneCount; _i8++) {\\n          var _boneData = data.bones[_i8];\\n          var grant = _boneData.grant;\\n          if (grant === undefined) continue;\\n          var _param2 = {\\n            index: _i8,\\n            parentIndex: grant.parentIndex,\\n            ratio: grant.ratio,\\n            isLocal: grant.isLocal,\\n            affectRotation: grant.affectRotation,\\n            affectPosition: grant.affectPosition,\\n            transformationClass: _boneData.transformationClass\\n          };\\n          grantEntryMap[_i8] = {\\n            parent: null,\\n            children: [],\\n            param: _param2,\\n            visited: false\\n          };\\n        }\\n\\n        var rootEntry = {\\n          parent: null,\\n          children: [],\\n          param: null,\\n          visited: false\\n        }; // Build a tree representing grant hierarchy\\n\\n        for (var boneIndex in grantEntryMap) {\\n          var grantEntry = grantEntryMap[boneIndex];\\n          var parentGrantEntry = grantEntryMap[grantEntry.parentIndex] || rootEntry;\\n          grantEntry.parent = parentGrantEntry;\\n          parentGrantEntry.children.push(grantEntry);\\n        }\\n\\n        traverse(rootEntry);\\n      } // morph\\n\\n\\n      function updateAttributes(attribute, morph, ratio) {\\n        for (var _i10 = 0; _i10 < morph.elementCount; _i10++) {\\n          var element = morph.elements[_i10];\\n          var index = void 0;\\n\\n          if (data.metadata.format === 'pmd') {\\n            index = data.morphs[0].elements[element.index].index;\\n          } else {\\n            index = element.index;\\n          }\\n\\n          attribute.array[index * 3 + 0] += element.position[0] * ratio;\\n          attribute.array[index * 3 + 1] += element.position[1] * ratio;\\n          attribute.array[index * 3 + 2] += element.position[2] * ratio;\\n        }\\n      }\\n\\n      for (var _i11 = 0; _i11 < data.metadata.morphCount; _i11++) {\\n        var morph = data.morphs[_i11];\\n        var params = {\\n          name: morph.name\\n        };\\n        var attribute = new _three.Float32BufferAttribute(data.metadata.vertexCount * 3, 3);\\n        attribute.name = morph.name;\\n\\n        for (var _j8 = 0; _j8 < data.metadata.vertexCount * 3; _j8++) {\\n          attribute.array[_j8] = positions[_j8];\\n        }\\n\\n        if (data.metadata.format === 'pmd') {\\n          if (_i11 !== 0) {\\n            updateAttributes(attribute, morph, 1.0);\\n          }\\n        } else {\\n          if (morph.type === 0) {\\n            // group\\n            for (var _j9 = 0; _j9 < morph.elementCount; _j9++) {\\n              var morph2 = data.morphs[morph.elements[_j9].index];\\n              var ratio = morph.elements[_j9].ratio;\\n\\n              if (morph2.type === 1) {\\n                updateAttributes(attribute, morph2, ratio);\\n              }\\n            }\\n          } else if (morph.type === 1) {\\n            // vertex\\n            updateAttributes(attribute, morph, 1.0);\\n          } else if (morph.type === 2) ;else if (morph.type === 3) ;else if (morph.type === 4) ;else if (morph.type === 5) ;else if (morph.type === 6) ;else if (morph.type === 7) ;else if (morph.type === 8) ;\\n        }\\n\\n        morphTargets.push(params);\\n        morphPositions.push(attribute);\\n      } // rigid bodies from rigidBodies field.\\n\\n\\n      for (var _i12 = 0; _i12 < data.metadata.rigidBodyCount; _i12++) {\\n        var rigidBody = data.rigidBodies[_i12];\\n        var _params = {};\\n\\n        for (var key in rigidBody) {\\n          _params[key] = rigidBody[key];\\n        }\\n        /*\\n         * RigidBody position parameter in PMX seems global position\\n         * while the one in PMD seems offset from corresponding bone.\\n         * So unify being offset.\\n         */\\n\\n\\n        if (data.metadata.format === 'pmx') {\\n          if (_params.boneIndex !== -1) {\\n            var _bone = data.bones[_params.boneIndex];\\n            _params.position[0] -= _bone.position[0];\\n            _params.position[1] -= _bone.position[1];\\n            _params.position[2] -= _bone.position[2];\\n          }\\n        }\\n\\n        rigidBodies.push(_params);\\n      } // constraints from constraints field.\\n\\n\\n      for (var _i13 = 0; _i13 < data.metadata.constraintCount; _i13++) {\\n        var constraint = data.constraints[_i13];\\n        var _params2 = {};\\n\\n        for (var _key in constraint) {\\n          _params2[_key] = constraint[_key];\\n        }\\n\\n        var bodyA = rigidBodies[_params2.rigidBodyIndex1];\\n        var bodyB = rigidBodies[_params2.rigidBodyIndex2]; // Refer to http://www20.atpages.jp/katwat/wp/?p=4135\\n\\n        if (bodyA.type !== 0 && bodyB.type === 2) {\\n          if (bodyA.boneIndex !== -1 && bodyB.boneIndex !== -1 && data.bones[bodyB.boneIndex].parentIndex === bodyA.boneIndex) {\\n            bodyB.type = 1;\\n          }\\n        }\\n\\n        constraints.push(_params2);\\n      } // build BufferGeometry.\\n\\n\\n      var geometry = new _three.BufferGeometry();\\n      geometry.setAttribute('position', new _three.Float32BufferAttribute(positions, 3));\\n      geometry.setAttribute('normal', new _three.Float32BufferAttribute(normals, 3));\\n      geometry.setAttribute('uv', new _three.Float32BufferAttribute(uvs, 2));\\n      geometry.setAttribute('skinIndex', new _three.Uint16BufferAttribute(skinIndices, 4));\\n      geometry.setAttribute('skinWeight', new _three.Float32BufferAttribute(skinWeights, 4));\\n      geometry.setIndex(indices);\\n\\n      for (var _i14 = 0, il = groups.length; _i14 < il; _i14++) {\\n        geometry.addGroup(groups[_i14].offset, groups[_i14].count, _i14);\\n      }\\n\\n      geometry.bones = bones;\\n      geometry.morphTargets = morphTargets;\\n      geometry.morphAttributes.position = morphPositions;\\n      geometry.morphTargetsRelative = false;\\n      geometry.userData.MMD = {\\n        bones: bones,\\n        iks: iks,\\n        grants: grants,\\n        rigidBodies: rigidBodies,\\n        constraints: constraints,\\n        format: data.metadata.format\\n      };\\n      geometry.computeBoundingSphere();\\n      return geometry;\\n    }\\n  }]);\\n\\n  return GeometryBuilder;\\n}(); //\\n\\n/**\\n * @param {THREE.LoadingManager} manager\\n */\\n\\n\\nvar MaterialBuilder =\\n/*#__PURE__*/\\nfunction () {\\n  function MaterialBuilder(manager) {\\n    _classCallCheck(this, MaterialBuilder);\\n\\n    this.manager = manager;\\n    this.textureLoader = new _three.TextureLoader(this.manager);\\n    this.tgaLoader = null; // lazy generation\\n\\n    this.crossOrigin = 'anonymous';\\n    this.resourcePath = undefined;\\n  }\\n  /**\\n   * @param {string} crossOrigin\\n   * @return {MaterialBuilder}\\n   */\\n\\n\\n  _createClass(MaterialBuilder, [{\\n    key: \\\"setCrossOrigin\\\",\\n    value: function setCrossOrigin(crossOrigin) {\\n      this.crossOrigin = crossOrigin;\\n      return this;\\n    }\\n    /**\\n     * @param {string} resourcePath\\n     * @return {MaterialBuilder}\\n     */\\n\\n  }, {\\n    key: \\\"setResourcePath\\\",\\n    value: function setResourcePath(resourcePath) {\\n      this.resourcePath = resourcePath;\\n      return this;\\n    }\\n    /**\\n     * @param {Object} data - parsed PMD/PMX data\\n     * @param {BufferGeometry} geometry - some properties are dependend on geometry\\n     * @param {function} onProgress\\n     * @param {function} onError\\n     * @return {Array<MeshToonMaterial>}\\n     */\\n\\n  }, {\\n    key: \\\"build\\\",\\n    value: function build(data, geometry\\n    /*, onProgress, onError */\\n    ) {\\n      var materials = [];\\n      var textures = {};\\n      this.textureLoader.setCrossOrigin(this.crossOrigin); // materials\\n\\n      for (var i = 0; i < data.metadata.materialCount; i++) {\\n        var material = data.materials[i];\\n        var params = {\\n          userData: {}\\n        };\\n        if (material.name !== undefined) params.name = material.name;\\n        /*\\n         * Color\\n         *\\n         * MMD         MeshToonMaterial\\n         * diffuse  -  color\\n         * ambient  -  emissive * a\\n         *               (a = 1.0 without map texture or 0.2 with map texture)\\n         *\\n         * MeshToonMaterial doesn't have ambient. Set it to emissive instead.\\n         * It'll be too bright if material has map texture so using coef 0.2.\\n         */\\n\\n        params.color = new _three.Color().fromArray(material.diffuse);\\n        params.opacity = material.diffuse[3];\\n        params.emissive = new _three.Color().fromArray(material.ambient);\\n        params.transparent = params.opacity !== 1.0; //\\n\\n        params.skinning = geometry.bones.length > 0 ? true : false;\\n        params.morphTargets = geometry.morphTargets.length > 0 ? true : false;\\n        params.fog = true; // blend\\n\\n        params.blending = _three.CustomBlending;\\n        params.blendSrc = _three.SrcAlphaFactor;\\n        params.blendDst = _three.OneMinusSrcAlphaFactor;\\n        params.blendSrcAlpha = _three.SrcAlphaFactor;\\n        params.blendDstAlpha = _three.DstAlphaFactor; // side\\n\\n        if (data.metadata.format === 'pmx' && (material.flag & 0x1) === 1) {\\n          params.side = _three.DoubleSide;\\n        } else {\\n          params.side = params.opacity === 1.0 ? _three.FrontSide : _three.DoubleSide;\\n        }\\n\\n        if (data.metadata.format === 'pmd') {\\n          // map, envMap\\n          if (material.fileName) {\\n            var fileName = material.fileName;\\n            var fileNames = fileName.split('*'); // fileNames[ 0 ]: mapFileName\\n            // fileNames[ 1 ]: envMapFileName( optional )\\n\\n            params.map = this._loadTexture(fileNames[0], textures);\\n\\n            if (fileNames.length > 1) {\\n              var extension = fileNames[1].slice(-4).toLowerCase();\\n              params.envMap = this._loadTexture(fileNames[1], textures);\\n              params.combine = extension === '.sph' ? _three.MultiplyOperation : _three.AddOperation;\\n            }\\n          } // gradientMap\\n\\n\\n          var toonFileName = material.toonIndex === -1 ? 'toon00.bmp' : data.toonTextures[material.toonIndex].fileName;\\n          params.gradientMap = this._loadTexture(toonFileName, textures, {\\n            isToonTexture: true,\\n            isDefaultToonTexture: this._isDefaultToonTexture(toonFileName)\\n          }); // parameters for OutlineEffect\\n\\n          params.userData.outlineParameters = {\\n            thickness: material.edgeFlag === 1 ? 0.003 : 0.0,\\n            color: [0, 0, 0],\\n            alpha: 1.0,\\n            visible: material.edgeFlag === 1\\n          };\\n        } else {\\n          // map\\n          if (material.textureIndex !== -1) {\\n            params.map = this._loadTexture(data.textures[material.textureIndex], textures);\\n          } // envMap TODO: support m.envFlag === 3\\n\\n\\n          if (material.envTextureIndex !== -1 && (material.envFlag === 1 || material.envFlag == 2)) {\\n            params.envMap = this._loadTexture(data.textures[material.envTextureIndex], textures);\\n            params.combine = material.envFlag === 1 ? _three.MultiplyOperation : _three.AddOperation;\\n          } // gradientMap\\n\\n\\n          var _toonFileName = void 0,\\n              isDefaultToon = void 0;\\n\\n          if (material.toonIndex === -1 || material.toonFlag !== 0) {\\n            _toonFileName = 'toon' + ('0' + (material.toonIndex + 1)).slice(-2) + '.bmp';\\n            isDefaultToon = true;\\n          } else {\\n            _toonFileName = data.textures[material.toonIndex];\\n            isDefaultToon = false;\\n          }\\n\\n          params.gradientMap = this._loadTexture(_toonFileName, textures, {\\n            isToonTexture: true,\\n            isDefaultToonTexture: isDefaultToon\\n          }); // parameters for OutlineEffect\\n\\n          params.userData.outlineParameters = {\\n            thickness: material.edgeSize / 300,\\n            // TODO: better calculation?\\n            color: material.edgeColor.slice(0, 3),\\n            alpha: material.edgeColor[3],\\n            visible: (material.flag & 0x10) !== 0 && material.edgeSize > 0.0\\n          };\\n        }\\n\\n        if (params.map !== undefined) {\\n          if (!params.transparent) {\\n            this._checkImageTransparency(params.map, geometry, i);\\n          }\\n\\n          params.emissive.multiplyScalar(0.2);\\n        }\\n\\n        materials.push(new _three.MeshToonMaterial(params));\\n      }\\n\\n      if (data.metadata.format === 'pmx') {\\n        // set transparent true if alpha morph is defined.\\n        var checkAlphaMorph = function checkAlphaMorph(elements, materials) {\\n          for (var _i15 = 0, il = elements.length; _i15 < il; _i15++) {\\n            var element = elements[_i15];\\n            if (element.index === -1) continue;\\n            var _material = materials[element.index];\\n\\n            if (_material.opacity !== element.diffuse[3]) {\\n              _material.transparent = true;\\n            }\\n          }\\n        };\\n\\n        for (var _i16 = 0, il = data.morphs.length; _i16 < il; _i16++) {\\n          var morph = data.morphs[_i16];\\n          var elements = morph.elements;\\n\\n          if (morph.type === 0) {\\n            for (var j = 0, jl = elements.length; j < jl; j++) {\\n              var morph2 = data.morphs[elements[j].index];\\n              if (morph2.type !== 8) continue;\\n              checkAlphaMorph(morph2.elements, materials);\\n            }\\n          } else if (morph.type === 8) {\\n            checkAlphaMorph(elements, materials);\\n          }\\n        }\\n      }\\n\\n      return materials;\\n    } // private methods\\n\\n  }, {\\n    key: \\\"_getTGALoader\\\",\\n    value: function _getTGALoader() {\\n      if (this.tgaLoader === null) {\\n        if (_TGALoader.TGALoader === undefined) {\\n          throw new Error('THREE.MMDLoader: Import TGALoader');\\n        }\\n\\n        this.tgaLoader = new _TGALoader.TGALoader(this.manager);\\n      }\\n\\n      return this.tgaLoader;\\n    }\\n  }, {\\n    key: \\\"_isDefaultToonTexture\\\",\\n    value: function _isDefaultToonTexture(name) {\\n      if (name.length !== 10) return false;\\n      return /toon(10|0[0-9])\\\\.bmp/.test(name);\\n    }\\n  }, {\\n    key: \\\"_loadTexture\\\",\\n    value: function _loadTexture(filePath, textures, params, onProgress, onError) {\\n      params = params || {};\\n      var scope = this;\\n      var fullPath;\\n\\n      if (params.isDefaultToonTexture === true) {\\n        var index;\\n\\n        try {\\n          index = parseInt(filePath.match(/toon([0-9]{2})\\\\.bmp$/)[1]);\\n        } catch (e) {\\n          console.warn('THREE.MMDLoader: ' + filePath + ' seems like a ' + 'not right default texture path. Using toon00.bmp instead.');\\n          index = 0;\\n        }\\n\\n        fullPath = DEFAULT_TOON_TEXTURES[index];\\n      } else {\\n        fullPath = this.resourcePath + filePath;\\n      }\\n\\n      if (textures[fullPath] !== undefined) return textures[fullPath];\\n      var loader = this.manager.getHandler(fullPath);\\n\\n      if (loader === null) {\\n        loader = filePath.slice(-4).toLowerCase() === '.tga' ? this._getTGALoader() : this.textureLoader;\\n      }\\n\\n      var texture = loader.load(fullPath, function (t) {\\n        // MMD toon texture is Axis-Y oriented\\n        // but Three.js gradient map is Axis-X oriented.\\n        // So here replaces the toon texture image with the rotated one.\\n        if (params.isToonTexture === true) {\\n          t.image = scope._getRotatedImage(t.image);\\n          t.magFilter = _three.NearestFilter;\\n          t.minFilter = _three.NearestFilter;\\n        }\\n\\n        t.flipY = false;\\n        t.wrapS = _three.RepeatWrapping;\\n        t.wrapT = _three.RepeatWrapping;\\n\\n        for (var i = 0; i < texture.readyCallbacks.length; i++) {\\n          texture.readyCallbacks[i](texture);\\n        }\\n\\n        delete texture.readyCallbacks;\\n      }, onProgress, onError);\\n      texture.readyCallbacks = [];\\n      textures[fullPath] = texture;\\n      return texture;\\n    }\\n  }, {\\n    key: \\\"_getRotatedImage\\\",\\n    value: function _getRotatedImage(image) {\\n      var canvas = document.createElement('canvas');\\n      var context = canvas.getContext('2d');\\n      var width = image.width;\\n      var height = image.height;\\n      canvas.width = width;\\n      canvas.height = height;\\n      context.clearRect(0, 0, width, height);\\n      context.translate(width / 2.0, height / 2.0);\\n      context.rotate(0.5 * Math.PI); // 90.0 * Math.PI / 180.0\\n\\n      context.translate(-width / 2.0, -height / 2.0);\\n      context.drawImage(image, 0, 0);\\n      return context.getImageData(0, 0, width, height);\\n    } // Check if the partial image area used by the texture is transparent.\\n\\n  }, {\\n    key: \\\"_checkImageTransparency\\\",\\n    value: function _checkImageTransparency(map, geometry, groupIndex) {\\n      map.readyCallbacks.push(function (texture) {\\n        // Is there any efficient ways?\\n        function createImageData(image) {\\n          var canvas = document.createElement('canvas');\\n          canvas.width = image.width;\\n          canvas.height = image.height;\\n          var context = canvas.getContext('2d');\\n          context.drawImage(image, 0, 0);\\n          return context.getImageData(0, 0, canvas.width, canvas.height);\\n        }\\n\\n        function detectImageTransparency(image, uvs, indices) {\\n          var width = image.width;\\n          var height = image.height;\\n          var data = image.data;\\n          var threshold = 253;\\n          if (data.length / (width * height) !== 4) return false;\\n\\n          for (var i = 0; i < indices.length; i += 3) {\\n            var centerUV = {\\n              x: 0.0,\\n              y: 0.0\\n            };\\n\\n            for (var j = 0; j < 3; j++) {\\n              var index = indices[i * 3 + j];\\n              var uv = {\\n                x: uvs[index * 2 + 0],\\n                y: uvs[index * 2 + 1]\\n              };\\n              if (getAlphaByUv(image, uv) < threshold) return true;\\n              centerUV.x += uv.x;\\n              centerUV.y += uv.y;\\n            }\\n\\n            centerUV.x /= 3;\\n            centerUV.y /= 3;\\n            if (getAlphaByUv(image, centerUV) < threshold) return true;\\n          }\\n\\n          return false;\\n        }\\n        /*\\n         * This method expects\\n         *   texture.flipY = false\\n         *   texture.wrapS = RepeatWrapping\\n         *   texture.wrapT = RepeatWrapping\\n         * TODO: more precise\\n         */\\n\\n\\n        function getAlphaByUv(image, uv) {\\n          var width = image.width;\\n          var height = image.height;\\n          var x = Math.round(uv.x * width) % width;\\n          var y = Math.round(uv.y * height) % height;\\n          if (x < 0) x += width;\\n          if (y < 0) y += height;\\n          var index = y * width + x;\\n          return image.data[index * 4 + 3];\\n        }\\n\\n        var imageData = texture.image.data !== undefined ? texture.image : createImageData(texture.image);\\n        var group = geometry.groups[groupIndex];\\n\\n        if (detectImageTransparency(imageData, geometry.attributes.uv.array, geometry.index.array.slice(group.start, group.start + group.count))) {\\n          map.transparent = true;\\n        }\\n      });\\n    }\\n  }]);\\n\\n  return MaterialBuilder;\\n}(); //\\n\\n\\nvar AnimationBuilder =\\n/*#__PURE__*/\\nfunction () {\\n  function AnimationBuilder() {\\n    _classCallCheck(this, AnimationBuilder);\\n  }\\n\\n  _createClass(AnimationBuilder, [{\\n    key: \\\"build\\\",\\n\\n    /**\\n     * @param {Object} vmd - parsed VMD data\\n     * @param {SkinnedMesh} mesh - tracks will be fitting to mesh\\n     * @return {AnimationClip}\\n     */\\n    value: function build(vmd, mesh) {\\n      // combine skeletal and morph animations\\n      var tracks = this.buildSkeletalAnimation(vmd, mesh).tracks;\\n      var tracks2 = this.buildMorphAnimation(vmd, mesh).tracks;\\n\\n      for (var i = 0, il = tracks2.length; i < il; i++) {\\n        tracks.push(tracks2[i]);\\n      }\\n\\n      return new _three.AnimationClip('', -1, tracks);\\n    }\\n    /**\\n     * @param {Object} vmd - parsed VMD data\\n     * @param {SkinnedMesh} mesh - tracks will be fitting to mesh\\n     * @return {AnimationClip}\\n     */\\n\\n  }, {\\n    key: \\\"buildSkeletalAnimation\\\",\\n    value: function buildSkeletalAnimation(vmd, mesh) {\\n      function pushInterpolation(array, interpolation, index) {\\n        array.push(interpolation[index + 0] / 127); // x1\\n\\n        array.push(interpolation[index + 8] / 127); // x2\\n\\n        array.push(interpolation[index + 4] / 127); // y1\\n\\n        array.push(interpolation[index + 12] / 127); // y2\\n      }\\n\\n      var tracks = [];\\n      var motions = {};\\n      var bones = mesh.skeleton.bones;\\n      var boneNameDictionary = {};\\n\\n      for (var i = 0, il = bones.length; i < il; i++) {\\n        boneNameDictionary[bones[i].name] = true;\\n      }\\n\\n      for (var _i17 = 0; _i17 < vmd.metadata.motionCount; _i17++) {\\n        var motion = vmd.motions[_i17];\\n        var boneName = motion.boneName;\\n        if (boneNameDictionary[boneName] === undefined) continue;\\n        motions[boneName] = motions[boneName] || [];\\n        motions[boneName].push(motion);\\n      }\\n\\n      for (var key in motions) {\\n        var array = motions[key];\\n        array.sort(function (a, b) {\\n          return a.frameNum - b.frameNum;\\n        });\\n        var times = [];\\n        var positions = [];\\n        var rotations = [];\\n        var pInterpolations = [];\\n        var rInterpolations = [];\\n        var basePosition = mesh.skeleton.getBoneByName(key).position.toArray();\\n\\n        for (var _i18 = 0, _il2 = array.length; _i18 < _il2; _i18++) {\\n          var time = array[_i18].frameNum / 30;\\n          var position = array[_i18].position;\\n          var rotation = array[_i18].rotation;\\n          var interpolation = array[_i18].interpolation;\\n          times.push(time);\\n\\n          for (var j = 0; j < 3; j++) {\\n            positions.push(basePosition[j] + position[j]);\\n          }\\n\\n          for (var _j10 = 0; _j10 < 4; _j10++) {\\n            rotations.push(rotation[_j10]);\\n          }\\n\\n          for (var _j11 = 0; _j11 < 3; _j11++) {\\n            pushInterpolation(pInterpolations, interpolation, _j11);\\n          }\\n\\n          pushInterpolation(rInterpolations, interpolation, 3);\\n        }\\n\\n        var targetName = '.bones[' + key + ']';\\n        tracks.push(this._createTrack(targetName + '.position', _three.VectorKeyframeTrack, times, positions, pInterpolations));\\n        tracks.push(this._createTrack(targetName + '.quaternion', _three.QuaternionKeyframeTrack, times, rotations, rInterpolations));\\n      }\\n\\n      return new _three.AnimationClip('', -1, tracks);\\n    }\\n    /**\\n     * @param {Object} vmd - parsed VMD data\\n     * @param {SkinnedMesh} mesh - tracks will be fitting to mesh\\n     * @return {AnimationClip}\\n     */\\n\\n  }, {\\n    key: \\\"buildMorphAnimation\\\",\\n    value: function buildMorphAnimation(vmd, mesh) {\\n      var tracks = [];\\n      var morphs = {};\\n      var morphTargetDictionary = mesh.morphTargetDictionary;\\n\\n      for (var i = 0; i < vmd.metadata.morphCount; i++) {\\n        var morph = vmd.morphs[i];\\n        var morphName = morph.morphName;\\n        if (morphTargetDictionary[morphName] === undefined) continue;\\n        morphs[morphName] = morphs[morphName] || [];\\n        morphs[morphName].push(morph);\\n      }\\n\\n      for (var key in morphs) {\\n        var array = morphs[key];\\n        array.sort(function (a, b) {\\n          return a.frameNum - b.frameNum;\\n        });\\n        var times = [];\\n        var values = [];\\n\\n        for (var _i19 = 0, il = array.length; _i19 < il; _i19++) {\\n          times.push(array[_i19].frameNum / 30);\\n          values.push(array[_i19].weight);\\n        }\\n\\n        tracks.push(new _three.NumberKeyframeTrack('.morphTargetInfluences[' + morphTargetDictionary[key] + ']', times, values));\\n      }\\n\\n      return new _three.AnimationClip('', -1, tracks);\\n    }\\n    /**\\n     * @param {Object} vmd - parsed VMD data\\n     * @return {AnimationClip}\\n     */\\n\\n  }, {\\n    key: \\\"buildCameraAnimation\\\",\\n    value: function buildCameraAnimation(vmd) {\\n      function pushVector3(array, vec) {\\n        array.push(vec.x);\\n        array.push(vec.y);\\n        array.push(vec.z);\\n      }\\n\\n      function pushQuaternion(array, q) {\\n        array.push(q.x);\\n        array.push(q.y);\\n        array.push(q.z);\\n        array.push(q.w);\\n      }\\n\\n      function pushInterpolation(array, interpolation, index) {\\n        array.push(interpolation[index * 4 + 0] / 127); // x1\\n\\n        array.push(interpolation[index * 4 + 1] / 127); // x2\\n\\n        array.push(interpolation[index * 4 + 2] / 127); // y1\\n\\n        array.push(interpolation[index * 4 + 3] / 127); // y2\\n      }\\n\\n      var cameras = vmd.cameras === undefined ? [] : vmd.cameras.slice();\\n      cameras.sort(function (a, b) {\\n        return a.frameNum - b.frameNum;\\n      });\\n      var times = [];\\n      var centers = [];\\n      var quaternions = [];\\n      var positions = [];\\n      var fovs = [];\\n      var cInterpolations = [];\\n      var qInterpolations = [];\\n      var pInterpolations = [];\\n      var fInterpolations = [];\\n      var quaternion = new _three.Quaternion();\\n      var euler = new _three.Euler();\\n      var position = new _three.Vector3();\\n      var center = new _three.Vector3();\\n\\n      for (var i = 0, il = cameras.length; i < il; i++) {\\n        var motion = cameras[i];\\n        var time = motion.frameNum / 30;\\n        var pos = motion.position;\\n        var rot = motion.rotation;\\n        var distance = motion.distance;\\n        var fov = motion.fov;\\n        var interpolation = motion.interpolation;\\n        times.push(time);\\n        position.set(0, 0, -distance);\\n        center.set(pos[0], pos[1], pos[2]);\\n        euler.set(-rot[0], -rot[1], -rot[2]);\\n        quaternion.setFromEuler(euler);\\n        position.add(center);\\n        position.applyQuaternion(quaternion);\\n        pushVector3(centers, center);\\n        pushQuaternion(quaternions, quaternion);\\n        pushVector3(positions, position);\\n        fovs.push(fov);\\n\\n        for (var j = 0; j < 3; j++) {\\n          pushInterpolation(cInterpolations, interpolation, j);\\n        }\\n\\n        pushInterpolation(qInterpolations, interpolation, 3); // use the same parameter for x, y, z axis.\\n\\n        for (var _j12 = 0; _j12 < 3; _j12++) {\\n          pushInterpolation(pInterpolations, interpolation, 4);\\n        }\\n\\n        pushInterpolation(fInterpolations, interpolation, 5);\\n      }\\n\\n      var tracks = []; // I expect an object whose name 'target' exists under THREE.Camera\\n\\n      tracks.push(this._createTrack('target.position', _three.VectorKeyframeTrack, times, centers, cInterpolations));\\n      tracks.push(this._createTrack('.quaternion', _three.QuaternionKeyframeTrack, times, quaternions, qInterpolations));\\n      tracks.push(this._createTrack('.position', _three.VectorKeyframeTrack, times, positions, pInterpolations));\\n      tracks.push(this._createTrack('.fov', _three.NumberKeyframeTrack, times, fovs, fInterpolations));\\n      return new _three.AnimationClip('', -1, tracks);\\n    } // private method\\n\\n  }, {\\n    key: \\\"_createTrack\\\",\\n    value: function _createTrack(node, typedKeyframeTrack, times, values, interpolations) {\\n      /*\\n       * optimizes here not to let KeyframeTrackPrototype optimize\\n       * because KeyframeTrackPrototype optimizes times and values but\\n       * doesn't optimize interpolations.\\n       */\\n      if (times.length > 2) {\\n        times = times.slice();\\n        values = values.slice();\\n        interpolations = interpolations.slice();\\n        var stride = values.length / times.length;\\n        var interpolateStride = interpolations.length / times.length;\\n        var index = 1;\\n\\n        for (var aheadIndex = 2, endIndex = times.length; aheadIndex < endIndex; aheadIndex++) {\\n          for (var i = 0; i < stride; i++) {\\n            if (values[index * stride + i] !== values[(index - 1) * stride + i] || values[index * stride + i] !== values[aheadIndex * stride + i]) {\\n              index++;\\n              break;\\n            }\\n          }\\n\\n          if (aheadIndex > index) {\\n            times[index] = times[aheadIndex];\\n\\n            for (var _i20 = 0; _i20 < stride; _i20++) {\\n              values[index * stride + _i20] = values[aheadIndex * stride + _i20];\\n            }\\n\\n            for (var _i21 = 0; _i21 < interpolateStride; _i21++) {\\n              interpolations[index * interpolateStride + _i21] = interpolations[aheadIndex * interpolateStride + _i21];\\n            }\\n          }\\n        }\\n\\n        times.length = index + 1;\\n        values.length = (index + 1) * stride;\\n        interpolations.length = (index + 1) * interpolateStride;\\n      }\\n\\n      var track = new typedKeyframeTrack(node, times, values);\\n\\n      track.createInterpolant = function InterpolantFactoryMethodCubicBezier(result) {\\n        return new CubicBezierInterpolation(this.times, this.values, this.getValueSize(), result, new Float32Array(interpolations));\\n      };\\n\\n      return track;\\n    }\\n  }]);\\n\\n  return AnimationBuilder;\\n}(); // interpolation\\n\\n\\nvar CubicBezierInterpolation =\\n/*#__PURE__*/\\nfunction (_Interpolant) {\\n  _inherits(CubicBezierInterpolation, _Interpolant);\\n\\n  function CubicBezierInterpolation(parameterPositions, sampleValues, sampleSize, resultBuffer, params) {\\n    var _this2;\\n\\n    _classCallCheck(this, CubicBezierInterpolation);\\n\\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(CubicBezierInterpolation).call(this, parameterPositions, sampleValues, sampleSize, resultBuffer));\\n    _this2.interpolationParams = params;\\n    return _this2;\\n  }\\n\\n  _createClass(CubicBezierInterpolation, [{\\n    key: \\\"interpolate_\\\",\\n    value: function interpolate_(i1, t0, t, t1) {\\n      var result = this.resultBuffer;\\n      var values = this.sampleValues;\\n      var stride = this.valueSize;\\n      var params = this.interpolationParams;\\n      var offset1 = i1 * stride;\\n      var offset0 = offset1 - stride; // No interpolation if next key frame is in one frame in 30fps.\\n      // This is from MMD animation spec.\\n      // '1.5' is for precision loss. times are Float32 in Three.js Animation system.\\n\\n      var weight1 = t1 - t0 < 1 / 30 * 1.5 ? 0.0 : (t - t0) / (t1 - t0);\\n\\n      if (stride === 4) {\\n        // Quaternion\\n        var x1 = params[i1 * 4 + 0];\\n        var x2 = params[i1 * 4 + 1];\\n        var y1 = params[i1 * 4 + 2];\\n        var y2 = params[i1 * 4 + 3];\\n\\n        var ratio = this._calculate(x1, x2, y1, y2, weight1);\\n\\n        _three.Quaternion.slerpFlat(result, 0, values, offset0, values, offset1, ratio);\\n      } else if (stride === 3) {\\n        // Vector3\\n        for (var i = 0; i !== stride; ++i) {\\n          var _x = params[i1 * 12 + i * 4 + 0];\\n          var _x2 = params[i1 * 12 + i * 4 + 1];\\n          var _y = params[i1 * 12 + i * 4 + 2];\\n          var _y2 = params[i1 * 12 + i * 4 + 3];\\n\\n          var _ratio = this._calculate(_x, _x2, _y, _y2, weight1);\\n\\n          result[i] = values[offset0 + i] * (1 - _ratio) + values[offset1 + i] * _ratio;\\n        }\\n      } else {\\n        // Number\\n        var _x3 = params[i1 * 4 + 0];\\n        var _x4 = params[i1 * 4 + 1];\\n        var _y3 = params[i1 * 4 + 2];\\n        var _y4 = params[i1 * 4 + 3];\\n\\n        var _ratio2 = this._calculate(_x3, _x4, _y3, _y4, weight1);\\n\\n        result[0] = values[offset0] * (1 - _ratio2) + values[offset1] * _ratio2;\\n      }\\n\\n      return result;\\n    }\\n  }, {\\n    key: \\\"_calculate\\\",\\n    value: function _calculate(x1, x2, y1, y2, x) {\\n      /*\\n       * Cubic Bezier curves\\n       *   https://en.wikipedia.org/wiki/B%C3%A9zier_curve#Cubic_B.C3.A9zier_curves\\n       *\\n       * B(t) = ( 1 - t ) ^ 3 * P0\\n       *      + 3 * ( 1 - t ) ^ 2 * t * P1\\n       *      + 3 * ( 1 - t ) * t^2 * P2\\n       *      + t ^ 3 * P3\\n       *      ( 0 <= t <= 1 )\\n       *\\n       * MMD uses Cubic Bezier curves for bone and camera animation interpolation.\\n       *   http://d.hatena.ne.jp/edvakf/20111016/1318716097\\n       *\\n       *    x = ( 1 - t ) ^ 3 * x0\\n       *      + 3 * ( 1 - t ) ^ 2 * t * x1\\n       *      + 3 * ( 1 - t ) * t^2 * x2\\n       *      + t ^ 3 * x3\\n       *    y = ( 1 - t ) ^ 3 * y0\\n       *      + 3 * ( 1 - t ) ^ 2 * t * y1\\n       *      + 3 * ( 1 - t ) * t^2 * y2\\n       *      + t ^ 3 * y3\\n       *      ( x0 = 0, y0 = 0 )\\n       *      ( x3 = 1, y3 = 1 )\\n       *      ( 0 <= t, x1, x2, y1, y2 <= 1 )\\n       *\\n       * Here solves this equation with Bisection method,\\n       *   https://en.wikipedia.org/wiki/Bisection_method\\n       * gets t, and then calculate y.\\n       *\\n       * f(t) = 3 * ( 1 - t ) ^ 2 * t * x1\\n       *      + 3 * ( 1 - t ) * t^2 * x2\\n       *      + t ^ 3 - x = 0\\n       *\\n       * (Another option: Newton's method\\n       *    https://en.wikipedia.org/wiki/Newton%27s_method)\\n       */\\n      var c = 0.5;\\n      var t = c;\\n      var s = 1.0 - t;\\n      var loop = 15;\\n      var eps = 1e-5;\\n      var math = Math;\\n      var sst3, stt3, ttt;\\n\\n      for (var i = 0; i < loop; i++) {\\n        sst3 = 3.0 * s * s * t;\\n        stt3 = 3.0 * s * t * t;\\n        ttt = t * t * t;\\n        var ft = sst3 * x1 + stt3 * x2 + ttt - x;\\n        if (math.abs(ft) < eps) break;\\n        c /= 2.0;\\n        t += ft < 0 ? c : -c;\\n        s = 1.0 - t;\\n      }\\n\\n      return sst3 * y1 + stt3 * y2 + ttt;\\n    }\\n  }]);\\n\\n  return CubicBezierInterpolation;\\n}(_three.Interpolant);\\n};\"],\n\"names\":[\"shadow$provide\",\"global\",\"require\",\"module\",\"exports\",\"_typeof\",\"obj\",\"Symbol\",\"iterator\",\"constructor\",\"prototype\",\"_classCallCheck\",\"instance\",\"Constructor\",\"TypeError\",\"_defineProperties\",\"target\",\"props\",\"i\",\"length\",\"descriptor\",\"enumerable\",\"configurable\",\"writable\",\"Object\",\"defineProperty\",\"key\",\"_createClass\",\"protoProps\",\"staticProps\",\"_possibleConstructorReturn\",\"self\",\"call\",\"ReferenceError\",\"_getPrototypeOf\",\"o\",\"setPrototypeOf\",\"getPrototypeOf\",\"__proto__\",\"_inherits\",\"subClass\",\"superClass\",\"create\",\"value\",\"_setPrototypeOf\",\"p\",\"MMDLoader\",\"_three\",\"_TGALoader\",\"_mmdParser\",\"_Loader\",\"manager\",\"_this\",\"loader\",\"FileLoader\",\"parser\",\"meshBuilder\",\"MeshBuilder\",\"animationBuilder\",\"AnimationBuilder\",\"setAnimationPath\",\"animationPath\",\"load\",\"url\",\"onLoad\",\"onProgress\",\"onError\",\"builder\",\"setCrossOrigin\",\"crossOrigin\",\"resourcePath\",\"path\",\"LoaderUtils\",\"extractUrlBase\",\"modelExtension\",\"_extractExtension\",\"toLowerCase\",\"Error\",\"data\",\"build\",\"loadAnimation\",\"object\",\"loadVMD\",\"vmd\",\"isCamera\",\"buildCameraAnimation\",\"loadWithAnimation\",\"modelUrl\",\"vmdUrl\",\"scope\",\"mesh\",\"animation\",\"loadPMD\",\"_getParser\",\"setMimeType\",\"undefined\",\"setPath\",\"setResponseType\",\"setRequestHeader\",\"requestHeader\",\"setWithCredentials\",\"withCredentials\",\"buffer\",\"parsePmd\",\"loadPMX\",\"parsePmx\",\"urls\",\"Array\",\"isArray\",\"vmds\",\"vmdNum\",\"il\",\"push\",\"parseVmd\",\"mergeVmds\",\"loadVPD\",\"isUnicode\",\"text\",\"parseVpd\",\"index\",\"lastIndexOf\",\"slice\",\"Parser\",\"Loader\",\"DEFAULT_TOON_TEXTURES\",\"geometryBuilder\",\"GeometryBuilder\",\"materialBuilder\",\"MaterialBuilder\",\"geometry\",\"material\",\"setResourcePath\",\"SkinnedMesh\",\"Skeleton\",\"bones\",\"gbone\",\"bone\",\"Bone\",\"name\",\"position\",\"fromArray\",\"pos\",\"quaternion\",\"rotq\",\"scl\",\"scale\",\"_i\",\"_il\",\"_gbone\",\"parent\",\"add\",\"updateMatrixWorld\",\"skeleton\",\"bind\",\"updateAttributes\",\"attribute\",\"morph\",\"ratio\",\"_i10\",\"elementCount\",\"element\",\"elements\",\"metadata\",\"format\",\"morphs\",\"array\",\"positions\",\"uvs\",\"normals\",\"indices\",\"groups\",\"skinIndices\",\"skinWeights\",\"morphTargets\",\"morphPositions\",\"iks\",\"grants\",\"rigidBodies\",\"constraints\",\"offset\",\"boneTypeTable\",\"vertexCount\",\"v\",\"vertices\",\"j\",\"jl\",\"_j\",\"_jl\",\"normal\",\"_j2\",\"_jl2\",\"uv\",\"_j3\",\"_j4\",\"_i2\",\"faceCount\",\"face\",\"_jl3\",\"faces\",\"_j5\",\"_i3\",\"materialCount\",\"materials\",\"count\",\"_i4\",\"rigidBodyCount\",\"body\",\"boneIndex\",\"type\",\"Math\",\"max\",\"_i5\",\"boneCount\",\"boneData\",\"transformationClass\",\"parentIndex\",\"rigidBodyType\",\"_i6\",\"ikCount\",\"ik\",\"param\",\"effector\",\"iteration\",\"maxAngle\",\"links\",\"_j6\",\"_jl4\",\"link\",\"enabled\",\"indexOf\",\"limitation\",\"Vector3\",\"_i7\",\"_ik\",\"_param\",\"_j7\",\"_jl5\",\"_link\",\"angleLimitation\",\"rotationMin\",\"lowerLimitationAngle\",\"rotationMax\",\"upperLimitationAngle\",\"tmp1\",\"tmp2\",\"grantEntryMap\",\"_i8\",\"_boneData\",\"grant\",\"children\",\"_param2\",\"isLocal\",\"affectRotation\",\"affectPosition\",\"visited\",\"rootEntry\",\"grantEntry\",\"parentGrantEntry\",\"traverse\",\"entry\",\"_i9\",\"child\",\"_i11\",\"morphCount\",\"params\",\"Float32BufferAttribute\",\"_j8\",\"_j9\",\"morph2\",\"_i12\",\"rigidBody\",\"_params\",\"_bone\",\"_i13\",\"constraintCount\",\"constraint\",\"_params2\",\"_key\",\"bodyA\",\"rigidBodyIndex1\",\"bodyB\",\"rigidBodyIndex2\",\"BufferGeometry\",\"setAttribute\",\"Uint16BufferAttribute\",\"setIndex\",\"_i14\",\"addGroup\",\"morphAttributes\",\"morphTargetsRelative\",\"userData\",\"MMD\",\"computeBoundingSphere\",\"textureLoader\",\"TextureLoader\",\"tgaLoader\",\"textures\",\"color\",\"Color\",\"diffuse\",\"opacity\",\"emissive\",\"ambient\",\"transparent\",\"skinning\",\"fog\",\"blending\",\"CustomBlending\",\"blendSrc\",\"SrcAlphaFactor\",\"blendDst\",\"OneMinusSrcAlphaFactor\",\"blendSrcAlpha\",\"blendDstAlpha\",\"DstAlphaFactor\",\"side\",\"flag\",\"DoubleSide\",\"FrontSide\",\"fileName\",\"fileNames\",\"split\",\"map\",\"_loadTexture\",\"extension\",\"envMap\",\"combine\",\"MultiplyOperation\",\"AddOperation\",\"toonFileName\",\"toonIndex\",\"toonTextures\",\"gradientMap\",\"isToonTexture\",\"isDefaultToonTexture\",\"_isDefaultToonTexture\",\"outlineParameters\",\"thickness\",\"edgeFlag\",\"alpha\",\"visible\",\"textureIndex\",\"envTextureIndex\",\"envFlag\",\"isDefaultToon\",\"_toonFileName\",\"toonFlag\",\"edgeSize\",\"edgeColor\",\"_checkImageTransparency\",\"multiplyScalar\",\"MeshToonMaterial\",\"checkAlphaMorph\",\"_i15\",\"_material\",\"_i16\",\"_getTGALoader\",\"TGALoader\",\"test\",\"filePath\",\"parseInt\",\"match\",\"e\",\"console\",\"warn\",\"fullPath\",\"getHandler\",\"texture\",\"t\",\"image\",\"_getRotatedImage\",\"magFilter\",\"NearestFilter\",\"minFilter\",\"flipY\",\"wrapS\",\"RepeatWrapping\",\"wrapT\",\"readyCallbacks\",\"canvas\",\"document\",\"createElement\",\"context\",\"getContext\",\"width\",\"height\",\"clearRect\",\"translate\",\"rotate\",\"PI\",\"drawImage\",\"getImageData\",\"groupIndex\",\"createImageData\",\"getAlphaByUv\",\"x\",\"round\",\"y\",\"imageData\",\"group\",\"detectImageTransparency\",\"centerUV\",\"threshold\",\"attributes\",\"start\",\"tracks\",\"buildSkeletalAnimation\",\"tracks2\",\"buildMorphAnimation\",\"AnimationClip\",\"pushInterpolation\",\"interpolation\",\"motions\",\"boneNameDictionary\",\"_i17\",\"motionCount\",\"motion\",\"boneName\",\"sort\",\"a\",\"b\",\"frameNum\",\"times\",\"rotations\",\"pInterpolations\",\"rInterpolations\",\"basePosition\",\"getBoneByName\",\"toArray\",\"_i18\",\"_il2\",\"rotation\",\"_j10\",\"_j11\",\"targetName\",\"_createTrack\",\"VectorKeyframeTrack\",\"QuaternionKeyframeTrack\",\"morphTargetDictionary\",\"morphName\",\"values\",\"_i19\",\"weight\",\"NumberKeyframeTrack\",\"pushVector3\",\"vec\",\"z\",\"pushQuaternion\",\"q\",\"w\",\"cameras\",\"centers\",\"quaternions\",\"fovs\",\"cInterpolations\",\"qInterpolations\",\"fInterpolations\",\"Quaternion\",\"euler\",\"Euler\",\"center\",\"rot\",\"distance\",\"fov\",\"set\",\"setFromEuler\",\"applyQuaternion\",\"_j12\",\"node\",\"typedKeyframeTrack\",\"interpolations\",\"stride\",\"interpolateStride\",\"aheadIndex\",\"endIndex\",\"_i20\",\"_i21\",\"track\",\"createInterpolant\",\"track.createInterpolant\",\"result\",\"CubicBezierInterpolation\",\"getValueSize\",\"Float32Array\",\"_Interpolant\",\"parameterPositions\",\"sampleValues\",\"sampleSize\",\"resultBuffer\",\"_this2\",\"interpolationParams\",\"interpolate_\",\"i1\",\"t0\",\"t1\",\"valueSize\",\"offset1\",\"offset0\",\"weight1\",\"_calculate\",\"x1\",\"x2\",\"y1\",\"y2\",\"slerpFlat\",\"_ratio\",\"_x\",\"_x2\",\"_y\",\"_y2\",\"_ratio2\",\"_x3\",\"_x4\",\"_y3\",\"_y4\",\"c\",\"s\",\"math\",\"sst3\",\"stt3\",\"ttt\",\"loop\",\"ft\",\"eps\",\"abs\",\"Interpolant\"]\n}\n"]