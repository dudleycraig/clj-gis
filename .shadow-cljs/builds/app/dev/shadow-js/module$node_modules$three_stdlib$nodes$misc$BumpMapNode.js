["^ ","~:resource-id",["~:shadow.build.npm/resource","node_modules/three-stdlib/nodes/misc/BumpMapNode.js"],"~:js","shadow$provide.module$node_modules$three_stdlib$nodes$misc$BumpMapNode=function(global,require,module,exports){function BumpMapNode(value,scale){_TempNode.TempNode.call(this,\"v3\");this.value=value;this.scale=scale||new _FloatNode.FloatNode(1);this.toNormalMap=!1}Object.defineProperty(exports,\"__esModule\",{value:!0});exports.BumpMapNode=BumpMapNode;var _TempNode=require(\"module$node_modules$three_stdlib$nodes$core$TempNode\"),_FloatNode=require(\"module$node_modules$three_stdlib$nodes$inputs$FloatNode\"),\n_FunctionNode=require(\"module$node_modules$three_stdlib$nodes$core$FunctionNode\"),_NormalNode=require(\"module$node_modules$three_stdlib$nodes$accessors$NormalNode\"),_PositionNode=require(\"module$node_modules$three_stdlib$nodes$accessors$PositionNode\");BumpMapNode.Nodes=function(){var dHdxy_fwd=new _FunctionNode.FunctionNode(\"vec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {\\n\\tvec2 dSTdx \\x3d dFdx( vUv );\\n\\tvec2 dSTdy \\x3d dFdy( vUv );\\n\\tfloat Hll \\x3d bumpScale * texture2D( bumpMap, vUv ).x;\\n\\tfloat dBx \\x3d bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\\tfloat dBy \\x3d bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\treturn vec2( dBx, dBy );\\n}\",\nnull,{derivatives:!0}),perturbNormalArb=new _FunctionNode.FunctionNode(\"vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\tvec3 vSigmaX \\x3d vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\\n\\tvec3 vSigmaY \\x3d vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\\n\\tvec3 vN \\x3d surf_norm;\\n\\tvec3 R1 \\x3d cross( vSigmaY, vN );\\n\\tvec3 R2 \\x3d cross( vN, vSigmaX );\\n\\tfloat fDet \\x3d dot( vSigmaX, R1 );\\n\\tfDet *\\x3d ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\\tvec3 vGrad \\x3d sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n}\",\n[dHdxy_fwd],{derivatives:!0}),bumpToNormal=new _FunctionNode.FunctionNode(\"vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {\\n\\tvec2 dSTdx \\x3d dFdx( uv );\\n\\tvec2 dSTdy \\x3d dFdy( uv );\\n\\tfloat Hll \\x3d texture2D( bumpMap, uv ).x;\\n\\tfloat dBx \\x3d texture2D( bumpMap, uv + dSTdx ).x - Hll;\\n\\tfloat dBy \\x3d texture2D( bumpMap, uv + dSTdy ).x - Hll;\\n\\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );\\n}\",null,{derivatives:!0});return{dHdxy_fwd,perturbNormalArb,bumpToNormal}}();\nBumpMapNode.prototype=Object.create(_TempNode.TempNode.prototype);BumpMapNode.prototype.constructor=BumpMapNode;BumpMapNode.prototype.nodeType=\"BumpMap\";BumpMapNode.prototype.hashProperties=[\"toNormalMap\"];BumpMapNode.prototype.generate=function(builder,output){if(builder.isShader(\"fragment\")){if(this.toNormalMap){var bumpToNormal=builder.include(BumpMapNode.Nodes.bumpToNormal);return builder.format(bumpToNormal+\"( \"+this.value.build(builder,\"sampler2D\")+\", \"+this.value.uv.build(builder,\"v2\")+\", \"+\nthis.scale.build(builder,\"f\")+\" )\",this.getType(builder),output)}var derivativeHeight=builder.include(BumpMapNode.Nodes.dHdxy_fwd);bumpToNormal=builder.include(BumpMapNode.Nodes.perturbNormalArb);this.normal=this.normal||new _NormalNode.NormalNode;this.position=this.position||new _PositionNode.PositionNode(_PositionNode.PositionNode.VIEW);derivativeHeight=derivativeHeight+\"( \"+this.value.build(builder,\"sampler2D\")+\", \"+this.value.uv.build(builder,\"v2\")+\", \"+this.scale.build(builder,\"f\")+\" )\";return builder.format(bumpToNormal+\n\"( -\"+this.position.build(builder,\"v3\")+\", \"+this.normal.build(builder,\"v3\")+\", \"+derivativeHeight+\" )\",this.getType(builder),output)}console.warn(\"THREE.BumpMapNode is not compatible with \"+builder.shader+\" shader.\");return builder.format(\"vec3( 0.0 )\",this.getType(builder),output)};BumpMapNode.prototype.copy=function(source){_TempNode.TempNode.prototype.copy.call(this,source);this.value=source.value;this.scale=source.scale;return this};BumpMapNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);\ndata||(data=this.createJSONNode(meta),data.value=this.value.toJSON(meta).uuid,data.scale=this.scale.toJSON(meta).uuid);return data}}","~:source","shadow$provide[\"module$node_modules$three_stdlib$nodes$misc$BumpMapNode\"] = function(global,require,module,exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.BumpMapNode = BumpMapNode;\n\nvar _TempNode = require(\"../core/TempNode.js\");\n\nvar _FloatNode = require(\"../inputs/FloatNode.js\");\n\nvar _FunctionNode = require(\"../core/FunctionNode.js\");\n\nvar _NormalNode = require(\"../accessors/NormalNode.js\");\n\nvar _PositionNode = require(\"../accessors/PositionNode.js\");\n\nfunction BumpMapNode(value, scale) {\n  _TempNode.TempNode.call(this, 'v3');\n\n  this.value = value;\n  this.scale = scale || new _FloatNode.FloatNode(1);\n  this.toNormalMap = false;\n}\n\nBumpMapNode.Nodes = function () {\n  var dHdxy_fwd = new _FunctionNode.FunctionNode([// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n  // http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n  // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n  'vec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {', // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n  '\tvec2 dSTdx = dFdx( vUv );', '\tvec2 dSTdy = dFdy( vUv );', '\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;', '\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;', '\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;', '\treturn vec2( dBx, dBy );', '}'].join('\\n'), null, {\n    derivatives: true\n  });\n  var perturbNormalArb = new _FunctionNode.FunctionNode(['vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {', // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n  '\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );', '\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );', '\tvec3 vN = surf_norm;', // normalized\n  '\tvec3 R1 = cross( vSigmaY, vN );', '\tvec3 R2 = cross( vN, vSigmaX );', '\tfloat fDet = dot( vSigmaX, R1 );', '\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );', '\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );', '\treturn normalize( abs( fDet ) * surf_norm - vGrad );', '}'].join('\\n'), [dHdxy_fwd], {\n    derivatives: true\n  });\n  var bumpToNormal = new _FunctionNode.FunctionNode(['vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {', '\tvec2 dSTdx = dFdx( uv );', '\tvec2 dSTdy = dFdy( uv );', '\tfloat Hll = texture2D( bumpMap, uv ).x;', '\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;', '\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;', '\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );', '}'].join('\\n'), null, {\n    derivatives: true\n  });\n  return {\n    dHdxy_fwd: dHdxy_fwd,\n    perturbNormalArb: perturbNormalArb,\n    bumpToNormal: bumpToNormal\n  };\n}();\n\nBumpMapNode.prototype = Object.create(_TempNode.TempNode.prototype);\nBumpMapNode.prototype.constructor = BumpMapNode;\nBumpMapNode.prototype.nodeType = 'BumpMap';\nBumpMapNode.prototype.hashProperties = ['toNormalMap'];\n\nBumpMapNode.prototype.generate = function (builder, output) {\n  if (builder.isShader('fragment')) {\n    if (this.toNormalMap) {\n      var bumpToNormal = builder.include(BumpMapNode.Nodes.bumpToNormal);\n      return builder.format(bumpToNormal + '( ' + this.value.build(builder, 'sampler2D') + ', ' + this.value.uv.build(builder, 'v2') + ', ' + this.scale.build(builder, 'f') + ' )', this.getType(builder), output);\n    } else {\n      var derivativeHeight = builder.include(BumpMapNode.Nodes.dHdxy_fwd),\n          perturbNormalArb = builder.include(BumpMapNode.Nodes.perturbNormalArb);\n      this.normal = this.normal || new _NormalNode.NormalNode();\n      this.position = this.position || new _PositionNode.PositionNode(_PositionNode.PositionNode.VIEW);\n      var derivativeHeightCode = derivativeHeight + '( ' + this.value.build(builder, 'sampler2D') + ', ' + this.value.uv.build(builder, 'v2') + ', ' + this.scale.build(builder, 'f') + ' )';\n      return builder.format(perturbNormalArb + '( -' + this.position.build(builder, 'v3') + ', ' + this.normal.build(builder, 'v3') + ', ' + derivativeHeightCode + ' )', this.getType(builder), output);\n    }\n  } else {\n    console.warn('THREE.BumpMapNode is not compatible with ' + builder.shader + ' shader.');\n    return builder.format('vec3( 0.0 )', this.getType(builder), output);\n  }\n};\n\nBumpMapNode.prototype.copy = function (source) {\n  _TempNode.TempNode.prototype.copy.call(this, source);\n\n  this.value = source.value;\n  this.scale = source.scale;\n  return this;\n};\n\nBumpMapNode.prototype.toJSON = function (meta) {\n  var data = this.getJSONNode(meta);\n\n  if (!data) {\n    data = this.createJSONNode(meta);\n    data.value = this.value.toJSON(meta).uuid;\n    data.scale = this.scale.toJSON(meta).uuid;\n  }\n\n  return data;\n};\n};","~:removed-requires",["~#set",[]],"~:actual-requires",["^5",["~$module$node_modules$three_stdlib$nodes$core$FunctionNode","~$module$node_modules$three_stdlib$nodes$accessors$NormalNode","~$shadow.js","~$module$node_modules$three_stdlib$nodes$inputs$FloatNode","~$module$node_modules$three_stdlib$nodes$accessors$PositionNode","~$module$node_modules$three_stdlib$nodes$core$TempNode"]],"~:properties",["^5",["Nodes","copy","prototype","scale","BumpMapNode","__esModule","generate","derivatives","normal","position","nodeType","hashProperties","value","perturbNormalArb","toNormalMap","bumpToNormal","dHdxy_fwd","constructor","toJSON"]],"~:compiled-at",1630917515221,"~:source-map-json","{\n\"version\":3,\n\"file\":\"module$node_modules$three_stdlib$nodes$misc$BumpMapNode.js\",\n\"lineCount\":8,\n\"mappings\":\"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\",\n\"sources\":[\"node_modules/three-stdlib/nodes/misc/BumpMapNode.js\"],\n\"sourcesContent\":[\"shadow$provide[\\\"module$node_modules$three_stdlib$nodes$misc$BumpMapNode\\\"] = function(global,require,module,exports) {\\n\\\"use strict\\\";\\n\\nObject.defineProperty(exports, \\\"__esModule\\\", {\\n  value: true\\n});\\nexports.BumpMapNode = BumpMapNode;\\n\\nvar _TempNode = require(\\\"../core/TempNode.js\\\");\\n\\nvar _FloatNode = require(\\\"../inputs/FloatNode.js\\\");\\n\\nvar _FunctionNode = require(\\\"../core/FunctionNode.js\\\");\\n\\nvar _NormalNode = require(\\\"../accessors/NormalNode.js\\\");\\n\\nvar _PositionNode = require(\\\"../accessors/PositionNode.js\\\");\\n\\nfunction BumpMapNode(value, scale) {\\n  _TempNode.TempNode.call(this, 'v3');\\n\\n  this.value = value;\\n  this.scale = scale || new _FloatNode.FloatNode(1);\\n  this.toNormalMap = false;\\n}\\n\\nBumpMapNode.Nodes = function () {\\n  var dHdxy_fwd = new _FunctionNode.FunctionNode([// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\\n  // http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\\n  // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\\n  'vec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {', // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\\n  '\\tvec2 dSTdx = dFdx( vUv );', '\\tvec2 dSTdy = dFdy( vUv );', '\\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;', '\\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;', '\\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;', '\\treturn vec2( dBx, dBy );', '}'].join('\\\\n'), null, {\\n    derivatives: true\\n  });\\n  var perturbNormalArb = new _FunctionNode.FunctionNode(['vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {', // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\\n  '\\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );', '\\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );', '\\tvec3 vN = surf_norm;', // normalized\\n  '\\tvec3 R1 = cross( vSigmaY, vN );', '\\tvec3 R2 = cross( vN, vSigmaX );', '\\tfloat fDet = dot( vSigmaX, R1 );', '\\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );', '\\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );', '\\treturn normalize( abs( fDet ) * surf_norm - vGrad );', '}'].join('\\\\n'), [dHdxy_fwd], {\\n    derivatives: true\\n  });\\n  var bumpToNormal = new _FunctionNode.FunctionNode(['vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {', '\\tvec2 dSTdx = dFdx( uv );', '\\tvec2 dSTdy = dFdy( uv );', '\\tfloat Hll = texture2D( bumpMap, uv ).x;', '\\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;', '\\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;', '\\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );', '}'].join('\\\\n'), null, {\\n    derivatives: true\\n  });\\n  return {\\n    dHdxy_fwd: dHdxy_fwd,\\n    perturbNormalArb: perturbNormalArb,\\n    bumpToNormal: bumpToNormal\\n  };\\n}();\\n\\nBumpMapNode.prototype = Object.create(_TempNode.TempNode.prototype);\\nBumpMapNode.prototype.constructor = BumpMapNode;\\nBumpMapNode.prototype.nodeType = 'BumpMap';\\nBumpMapNode.prototype.hashProperties = ['toNormalMap'];\\n\\nBumpMapNode.prototype.generate = function (builder, output) {\\n  if (builder.isShader('fragment')) {\\n    if (this.toNormalMap) {\\n      var bumpToNormal = builder.include(BumpMapNode.Nodes.bumpToNormal);\\n      return builder.format(bumpToNormal + '( ' + this.value.build(builder, 'sampler2D') + ', ' + this.value.uv.build(builder, 'v2') + ', ' + this.scale.build(builder, 'f') + ' )', this.getType(builder), output);\\n    } else {\\n      var derivativeHeight = builder.include(BumpMapNode.Nodes.dHdxy_fwd),\\n          perturbNormalArb = builder.include(BumpMapNode.Nodes.perturbNormalArb);\\n      this.normal = this.normal || new _NormalNode.NormalNode();\\n      this.position = this.position || new _PositionNode.PositionNode(_PositionNode.PositionNode.VIEW);\\n      var derivativeHeightCode = derivativeHeight + '( ' + this.value.build(builder, 'sampler2D') + ', ' + this.value.uv.build(builder, 'v2') + ', ' + this.scale.build(builder, 'f') + ' )';\\n      return builder.format(perturbNormalArb + '( -' + this.position.build(builder, 'v3') + ', ' + this.normal.build(builder, 'v3') + ', ' + derivativeHeightCode + ' )', this.getType(builder), output);\\n    }\\n  } else {\\n    console.warn('THREE.BumpMapNode is not compatible with ' + builder.shader + ' shader.');\\n    return builder.format('vec3( 0.0 )', this.getType(builder), output);\\n  }\\n};\\n\\nBumpMapNode.prototype.copy = function (source) {\\n  _TempNode.TempNode.prototype.copy.call(this, source);\\n\\n  this.value = source.value;\\n  this.scale = source.scale;\\n  return this;\\n};\\n\\nBumpMapNode.prototype.toJSON = function (meta) {\\n  var data = this.getJSONNode(meta);\\n\\n  if (!data) {\\n    data = this.createJSONNode(meta);\\n    data.value = this.value.toJSON(meta).uuid;\\n    data.scale = this.scale.toJSON(meta).uuid;\\n  }\\n\\n  return data;\\n};\\n};\"],\n\"names\":[\"shadow$provide\",\"global\",\"require\",\"module\",\"exports\",\"BumpMapNode\",\"value\",\"scale\",\"_TempNode\",\"TempNode\",\"call\",\"_FloatNode\",\"FloatNode\",\"toNormalMap\",\"Object\",\"defineProperty\",\"_FunctionNode\",\"_NormalNode\",\"_PositionNode\",\"Nodes\",\"dHdxy_fwd\",\"FunctionNode\",\"derivatives\",\"perturbNormalArb\",\"bumpToNormal\",\"prototype\",\"create\",\"constructor\",\"nodeType\",\"hashProperties\",\"generate\",\"BumpMapNode.prototype.generate\",\"builder\",\"output\",\"isShader\",\"include\",\"format\",\"build\",\"uv\",\"getType\",\"derivativeHeight\",\"normal\",\"NormalNode\",\"position\",\"PositionNode\",\"VIEW\",\"derivativeHeightCode\",\"console\",\"warn\",\"shader\",\"copy\",\"BumpMapNode.prototype.copy\",\"source\",\"toJSON\",\"BumpMapNode.prototype.toJSON\",\"meta\",\"data\",\"getJSONNode\",\"createJSONNode\",\"uuid\"]\n}\n"]